
<!DOCTYPE html>
<!--/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner       ATECSEVEN TECNOLOGIA
 * @cnpj        63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */-->
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>edu10 Avalia√ß√µes - Gerador de Provas</title>
    <!--/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner       ATECSEVEN TECNOLOGIA
 * @cnpj        63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */-->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    
    <style>
    /* 1. SISTEMA DE DESIGN (INTERFACE DO USU√ÅRIO) */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    :root {
        --primary-color: #3f51b5;
        --primary-dark: #303f9f;
        --secondary-color: #f44336;
        --background-color: #f4f7f6;
        --card-bg: #ffffff;
        --text-color: #1e293b;
        --border-color: #e2e8f0;
        --radius: 8px;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --transition: all 0.2s ease;
    }

    * {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        padding: 0;
        font-family: 'Inter', 'Arial', sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
    }

    .container {
        display: flex;
        min-height: 100vh;
    }

    /* LOGIN */
    #login-screen {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100vw;
        background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-color) 100%);
    }
    .login-box {
        width: 380px;
        padding: 40px;
        background: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        text-align: center;
    }
    .login-box h2 {
        color: var(--primary-color);
        margin-bottom: 8px;
        font-weight: 700;
    }
    .login-box p {
        font-size: 0.9em;
        color: #64748b;
        margin-bottom: 24px;
    }
    .login-box input {
        width: 100%;
        padding: 12px;
        margin-bottom: 16px;
        border-radius: 6px;
        border: 1px solid #ddd;
        transition: var(--transition);
    }
    .login-box input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(63, 81, 181, 0.1);
    }

    /* BOT√ïES */
    .btn-primary, .btn-secondary, .btn-danger, .btn-success, .btn-warning {
        padding: 10px 18px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        margin-right: 5px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    .btn-primary { background-color: var(--primary-color); color: white; }
    .btn-primary:hover { background-color: var(--primary-dark); transform: translateY(-1px); }
    .btn-secondary { background-color: #64748b; color: white; }
    .btn-secondary:hover { background-color: #475569; }
    .btn-danger { background-color: var(--secondary-color); color: white; }
    .btn-danger:hover { background-color: #d32f2f; }
    .btn-success { background-color: #10b981; color: white; }
    .btn-warning { background-color: #f59e0b; color: white; }
    .btn-sm { padding: 6px 12px; font-size: 0.85em; }

    /* INTERFACE PRINCIPAL */
    #main-interface {
        display: none;  
        flex-direction: column;
        width: 100%;
    }
    
    header {
        background-color: var(--card-bg);
        color: var(--text-color);
        padding: 15px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border-color);
    }
    header h1 {
        margin: 0;
        font-size: 1.4em;
        font-weight: 700;
    }
    #user-role-display {
        font-size: 0.75em;
        background: #e0e7ff;
        color: var(--primary-color);
        padding: 4px 10px;
        border-radius: 4px;
        font-weight: 600;
    }

    .nav-menu {
        list-style: none;
        padding: 0;
        margin: 0;
        background: #1e293b;
        display: flex;
    }
    .nav-menu li a {
        display: block;
        padding: 14px 24px;
        color: #cbd5e1;
        text-decoration: none;
        transition: var(--transition);
        font-weight: 500;
        font-size: 0.95em;
    }
    .nav-menu li a:hover, .nav-menu li a.active {
        color: white;
        background-color: var(--primary-color);
    }

    .page-section {
        display: none;  
        padding: 30px;
        flex-grow: 1;
        max-width: 1200px;
        margin: 24px auto;
        background: var(--card-bg);
        border-radius: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-color);
    }
    .page-section h2 {
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 10px;
        margin-bottom: 25px;
        color: var(--primary-color);
        font-weight: 700;
    }
    
    /* FORMUL√ÅRIOS DA INTERFACE */
    .page-section form label {
        display: block;
        margin-top: 15px;
        margin-bottom: 6px;
        font-weight: 600;
        font-size: 0.9em;
    }
    .page-section form input:not([type="checkbox"]),
    .page-section form select,
    .page-section form textarea,
    .modal-content form input:not([type="file"]):not([type="checkbox"]):not([type="radio"]),
    .modal-content form select,
    .modal-content form textarea {
        width: 100%;
        padding: 11px;
        border: 1px solid #cbd5e1;
        border-radius: 6px;
        margin-bottom: 12px;
        font-size: 0.95em;
    }

    .dashboard-grid {
    display: grid;
    /* Define 4 colunas iguais por padr√£o. Se tiver 3 ou 5 cards, mude o n√∫mero 4 */
    grid-template-columns: repeat(auto-flow, minmax(0, 1fr)); 
    /* Alternativamente, para for√ßar sempre uma linha independente do n√∫mero de cards: */
    grid-auto-flow: column;
    grid-auto-columns: 1fr;
    
    gap: 15px;
    margin-bottom: 15px;
    width: 100%;
    overflow-x: auto; /* Adiciona scroll horizontal sutil se a tela for MUITO pequena */
}

.indicator-card {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    box-shadow: var(--shadow-md);
    min-width: 150px; /* Impede que o card fique ileg√≠vel em telas pequenas */
}

.indicator-card h3 {
    margin: 0;
    font-size: 1.8em; /* Reduzi levemente para caber melhor em uma linha s√≥ */
    font-weight: 700;
}

.indicator-card p {
    margin: 5px 0 0;
    font-size: 0.85em;
    opacity: 0.9;
    white-space: nowrap; /* Evita que o texto do r√≥tulo quebre linha */
}

    .exam-list li, #questions-bank-list li, .user-list li {
        padding: 18px;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
    }
    .exam-list li:hover { background-color: #f8fafc; }

    .filter-container {
        margin-bottom: 24px;
        padding: 18px;
        background: #f1f5f9;
        border-radius: 8px;
        display: flex;
        gap: 12px;
        align-items: center;
    }
    
    /* ALERTAS */
    .alert-error { background-color: #fef2f2; color: #991b1b; border: 1px solid #fecaca; padding: 12px; border-radius: 6px; margin-bottom: 15px;}
    .alert-success { background-color: #ecfdf5; color: #065f46; border: 1px solid #a7f3d0; padding: 12px; border-radius: 6px; margin-bottom: 15px;}

    /* MODAL */
    .modal {
        display: none;  
        position: fixed;    
        z-index: 1000;  
        left: 0;
        top: 0;
        width: 100%;    
        height: 100%;   
        overflow: auto; 
        background-color: rgba(15, 23, 42, 0.6);   
        backdrop-filter: blur(4px);
        padding-top: 60px;
    }
    .modal-content {
        background-color: var(--card-bg);
        margin: 2% auto;    
        padding: 32px;
        width: 85%; 
        max-width: 900px;
        border-radius: 12px;
        position: relative;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
    }

    /* 2. RESTAURA√á√ÉO DA √ÅREA DE PREVISUALIZA√á√ÉO (Fiel ao original) */
    #exam-preview {
        border: 1px solid #ddd;
        padding: 20px; 
        background: white;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        max-width: 210mm;   
        margin: 20px auto;  
        min-height: 297mm;
        font-family: 'Times New Roman', serif; /* Mantido fixo */
    }
    
    #exam-content-print {
        padding: 10px;
    }
    #exam-content-print .exam-header-print {
        border: 1px solid #000;
        padding: 0; 
        margin-bottom: 20px;
        display: grid;
        grid-template-columns: 20% 80%; 
        font-size: 10pt;
    }
    #exam-content-print .exam-header-print table {
         width: 100%; 
         border-collapse: collapse; 
         font-size: 10pt;
    }
    #exam-content-print .exam-header-print table,
    #exam-content-print .exam-header-print td {
        border: 1px solid #000;
    }
    #exam-content-print .exam-header-print td {
        padding: 3px 5px;
    }
    #exam-content-print .exam-header-print .logo-area {
        border: 1px solid #000; 
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 5px;
    }
    #exam-content-print .exam-header-print .logo-area img {
        max-width: 100%;
        max-height: 50px;
        height: auto;
    }
    #exam-content-print .questions-wrapper {
         column-count: 1; 
         gap: 20px;
    }
    #exam-content-print .question-item-print {
         border: 1px solid #ddd;
         padding: 10px;
         margin-bottom: 15px;
    }
    #exam-content-print .q-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         background-color: #fff8e1; 
         padding: 5px;
         margin: -10px -10px 10px -10px;
         border-bottom: 1px solid #ccc;
    }
    #exam-content-print .q-header strong {
         font-size: 12pt;
         color: #3f51b5;
    }
    #exam-content-print .q-enunciado {
         font-size: 11pt;
         margin-bottom: 10px;
    }
    #exam-content-print .alternative-list-print {
         list-style: none;
         padding: 0;
         margin: 0;
    }
    #exam-content-print .alternative-list-print li label {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        font-size: 11pt;
    }
    #exam-content-print .alternative-list-print input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.2);
    }

 
    #print-area-container {
        display: none; 
        font-family: 'Times New Roman', serif;
    }

    .af-garbage {
        position: absolute;
        opacity: 0;
        color: transparent;
        font-size: 1px;
        width: 1px;
        height: 1px;
        overflow: hidden;
        pointer-events: none;
        user-select: none;
        z-index: -999;
    }
    
    @media print {
        @page {
            size: A4;
            margin: 18mm 15mm 15mm 18mm; 
            
            @bottom-right {
                content: "P√°gina " counter(page) " de " counter(pages);
                font-size: 9pt;
                font-family: 'Times New Roman', serif;
                color: #000;
            }
            
            @bottom-left {
                content: "By Atecseven tecnologia - www.atecseven.com.br - CNPJ 63.373.374/0001-72";
                font-size: 8pt;
                font-family: 'Times New Roman', serif;
                color: #555;
            }
        }
        
        body {
            background: none !important;
            color: black !important;
            margin: 0 !important;
            padding: 0 !important;
            font-size: 11pt !important;    
            line-height: 1.4 !important;
            font-family: 'Times New Roman', serif !important;
        }

        body > *:not(#print-area-container) {
            display: none !important;
        }
        
        #print-area-container {
            display: block !important;
            width: 100% !important;
            padding: 0 !important;
            margin: 0 !important;
            box-shadow: none !important;
        }

        .exam-header-print {
            border: 1px solid #000 !important; 
            padding: 0 !important;
            margin-bottom: 15px !important;
            display: grid !important;
            grid-template-columns: 20% 80% !important; 
            break-after: avoid; 
            page-break-after: avoid;
        }
        .exam-header-print .logo-area {
            border: none !important; 
            border-right: 1px solid #000 !important; 
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px;
        }
        .exam-header-print .logo-area img {
            max-width: 100%;
            max-height: 70px;
        }
        .exam-header-print table {
            border-collapse: collapse !important;
            width: 100% !important;
            height: 100% !important;
        }
        .exam-header-print table, .exam-header-print td {
            border: none !important;
        }
        .exam-header-print td {
            border-top: 1px solid #000 !important; 
            border-left: 1px solid #000 !important;
            padding: 3px 5px !important;
            font-size: 9pt !important;
            vertical-align: top !important;
        }
        .exam-header-print > div:nth-child(2) > table > tbody > tr:first-child > td {
             border-top: none !important;
         }
        .exam-header-print > div:nth-child(2) > table > tbody > tr > td:first-child {
            border-left: none !important;
        }
        
        .instructions-text {
            font-size: 9pt !important;
            margin-bottom: 10px !important; 
            padding: 5px 10px !important;
            border: 1px solid #000 !important;
            text-align: justify !important;
        }

        .questions-wrapper {
            column-count: var(--print-col-count, 1) !important; 
            column-gap: 15mm !important;
            column-rule: 1px solid #ccc !important;
            page-break-after: auto;
        }
        .question-item-print {
            margin-bottom: 10px !important;
            padding: 0 !important; 
            border: none !important;
            break-inside: avoid-column !important; 
            page-break-inside: avoid !important;
        }
        .q-header {
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            background-color: transparent !important; 
            padding: 3px 0 !important;
            margin: 0 0 5px 0 !important;
            border-bottom: 1px dotted #ccc !important; 
        }
        .q-header strong {
            font-size: 11pt !important;
            font-weight: bold !important;
            color: #333 !important;
        }
        .q-enunciado {
            font-size: 10.5pt !important;
            margin: 5px 0 5px 5px !important; 
            text-align: justify !important;
        }
        
        .image-preview { 
            max-width: 60% !important; 
            height: auto !important; 
            margin: 8px 0 !important; 
        }

        .discursiva-answer-space {
            border: 1px dashed #aaa !important;    
            margin-top: 5px !important; 
            padding: 5px !important;
        }
    }

    footer {
        padding: 20px;
        text-align: center;
        font-size: 0.8em;
        color: #94a3b8;
        border-top: 1px solid var(--border-color);
        margin-top: auto;
    }
</style>
</head>
<div id="loading-overlay" class="loading-overlay">
    <div class="loading-content">
        <img src="img/logo-edu10.jpeg" alt="Logo" id="loading-logo" class="loading-logo">
        
        <div class="progress-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        
        <p id="education-quote" class="education-quote">"Carregando sabedoria..."</p>
        <span class="loading-status">Carregando ambiente...</span>
    </div>
</div>

<div id="update-toast" class="update-toast">
    <div class="toast-content">
        <i class="fas fa-rocket"></i>
        <span>Sistema atualizado! Nova vers√£o <b>2.1.0</b> dispon√≠vel.</span>
    </div>
</div>

<style>
    /* MODAL DE CARREGAMENTO */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #f8fafc;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        transition: opacity 0.6s ease, visibility 0.6s;
    }

    .loading-content {
        text-align: center;
        width: 90%;
        max-width: 400px;
        transition: all 0.4s ease;
    }

    .loading-logo {
        max-height: 65px;
        margin-bottom: 30px;
        transition: all 0.3s cubic-bezier(0.6, -0.28, 0.735, 0.045); /* Efeito de encolhimento r√°pido */
        transform: scale(1);
    }

    /* Classe disparada pelo JS ao fim do load */
    .loading-logo.shrink {
        transform: scale(0);
        opacity: 0;
    }

    .progress-container {
        width: 100%;
        height: 6px;
        background: #e2e8f0;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 20px;
    }

    .progress-bar {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #3f51b5, #6366f1);
        box-shadow: 0 0 10px rgba(63, 81, 181, 0.3);
        transition: width 0.3s ease;
    }

    .education-quote {
        font-family: 'Inter', sans-serif;
        font-style: italic;
        color: #64748b;
        font-size: 0.95rem;
        margin-bottom: 8px;
        min-height: 3rem;
    }

    .loading-status {
        font-family: 'Inter', sans-serif;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #94a3b8;
    }

    /* TOAST DE ATUALIZA√á√ÉO */
    .update-toast {
        position: fixed;
        top: -100px;
        left: 50%;
        transform: translateX(-50%);
        background: #ffffff;
        color: #1e293b;
        padding: 12px 24px;
        border-radius: 50px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        z-index: 9999;
        transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 1px solid #e2e8f0;
    }

    .update-toast.show { top: 25px; }
    
</style>

<script>
    const quotes = [
        '"A educa√ß√£o √© a arma mais poderosa que voc√™ pode usar para mudar o mundo." - Nelson Mandela',
        '"Ensinar n√£o √© transferir conhecimento, mas criar as possibilidades para a sua produ√ß√£o." - Paulo Freire',
        '"A educa√ß√£o tem ra√≠zes amargas, mas os seus frutos s√£o doces." - Arist√≥teles',
        '"Onde quer que voc√™ veja um neg√≥cio de sucesso, algu√©m tomou uma decis√£o corajosa." - Peter Drucker'
    ];

    document.addEventListener('DOMContentLoaded', function() {
        const overlay = document.getElementById('loading-overlay');
        const progressBar = document.getElementById('progress-bar');
        const logo = document.getElementById('loading-logo');
        const quoteElement = document.getElementById('education-quote');
        const toast = document.getElementById('update-toast');

        // Selecionar cita√ß√£o aleat√≥ria
        quoteElement.innerText = quotes[Math.floor(Math.random() * quotes.length)];

        let width = 0;
        const interval = setInterval(() => {
            if (width >= 100) {
                clearInterval(interval);
                
                // 1. Encolher a logo rapidamente
                logo.classList.add('shrink');

                // 2. Aguardar o efeito de encolhimento e fechar o modal
                setTimeout(() => {
                    overlay.style.opacity = '0';
                    overlay.style.visibility = 'hidden';
                    
                    // 3. Mostrar o Toast de vers√£o
                    setTimeout(() => {
                        toast.classList.add('show');
                        setTimeout(() => toast.classList.remove('show'), 5000);
                    }, 600);
                }, 300); 

            } else {
                width += Math.random() * 20; 
                if (width > 100) width = 100;
                progressBar.style.width = width + '%';
            }
        }, 250);
    });
</script>
    <div id="login-screen">
        <div class="login-box">
            <img src="img/logo-edu10.jpeg" alt="" width="150px" height="50px">
            <!--<h2><i class="fas fa-school"></i> edu10 Avalia√ß√µes</h2>-->
            <p>Acesse com seu e-mail e senha.</p>
            <input type="email" id="login-user" placeholder="E-mail">
            <input type="password" id="login-password" placeholder="Senha">
            <button class="btn-primary" onclick="handleLogin()"><i class="fas fa-sign-in-alt"></i> Entrar</button>
            <button class="btn-secondary" onclick="openModal('modal-request-access')" style="margin-top: 10px; width: 100%;"><i class="fas fa-user-plus"></i> Solicitar Acesso</button>
            <div id="login-message" style="margin-top: 15px;"></div>
        </div>
    </div>
<!--/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner       ATECSEVEN TECNOLOGIA
 * @cnpj        63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */-->
    <div id="main-interface">
        <header>
            <div style="display: flex; align-items: center;">
                <img src="img/logo-edu10.jpeg" alt="" width="150px" height="50px">
                
                <span id="user-info-display"></span>
            </div>
            <div>
                <span id="user-role-display"></span>
                <button class="btn-danger" onclick="simularLogout()"><i class="fas fa-sign-out-alt"></i> Sair</button>
            </div>
            
        </header>
        
<!--/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner       ATECSEVEN TECNOLOGIA
 * @cnpj        63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */-->
        <nav>
            <ul class="nav-menu">
                <li><a id="nav-dashboard" href="#" onclick="showPage('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a id="nav-createquestion" href="#" onclick="showPage('create-question')"><i class="fas fa-plus-circle"></i> Criar Quest√£o</a></li>
                <li><a id="nav-bank" href="#" onclick="showPage('bank')"><i class="fas fa-database"></i> Banco de Quest√µes</a></li>
                <li><a id="nav-createexam" href="#" onclick="showPage('create-exam')"><i class="fas fa-file-export"></i> Gerar Prova</a></li>
                <li><a id="nav-myexams" href="#" onclick="showPage('my-exams')"><i class="fas fa-clipboard-list"></i> Minhas Provas</a></li>
                <li id="nav-admin" style="display: none;"><a id="nav-admin" href="#" onclick="showPage('admin')"><i class="fas fa-user-shield"></i> Administra√ß√£o</a></li>
            </ul>
        </nav>

        <main>
            <section id="dashboard" class="page-section">
                <h2><i class="fas fa-tachometer-alt"></i> Resumo do Sistema</h2>
                <div class="dashboard-grid">
                    <div class="indicator-card">
                        <p>Total de Quest√µes no Banco</p>
                        <h3 id="dash-total-questoes">0</h3>
                    </div>
                    <div class="indicator-card">
                        <p>Total de Provas Geradas</p>
                        <h3 id="dash-total-provas">0</h3>
                    </div>
                    <div class="indicator-card" style="background-color: #00bcd4;">
                        <p>Usu√°rios Padr√£o</p>
                        <h3 id="dash-total-padrao">0</h3>
                    </div>
                    <div class="indicator-card" style="background-color: #ff9800;">
                        <p>Usu√°rios ADM</p>
                        <h3 id="dash-total-adm">0</h3>
                    </div>
                    <div class="indicator-card" style="background-color: var(--secondary-color);">
                        <p>Usu√°rios Pendentes</p>
                        <h3 id="dash-total-pendentes">0</h3>
                    </div>
                </div>
            </section>

            <section id="create-question" class="page-section">
                <h2><i class="fas fa-plus-circle"></i> Cadastrar Nova Quest√£o</h2>
                <div class="alert-info"><i class="fas fa-info-circle"></i> O upload de todas as imagens agora utiliza o ImgAtecsevenServer.</div>
                <form id="form-create-question">
                    <div class="dashboard-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div>
                            <label for="modalidade">Modalidade de Ensino:</label>
                            <select id="modalidade" required>
                                <option value="Ensino Fundamental I">Ensino Fundamental I</option>
                                <option value="Ensino Fundamental II">Ensino Fundamental II</option>
                                <option value="Ensino M√©dio">Ensino M√©dio</option>
                            </select>

                            <label for="componente">Componente Curricular:</label>
                            <input type="text" id="componente" placeholder="Ex: Matem√°tica, Portugu√™s, Ci√™ncias" required>
                            
                            <label for="habilidade">Habilidade BNCC (D-XX):</label>
                            <input type="text" id="habilidade" placeholder="Ex: D 33">
                            
                            <label for="tipo">Tipo de Quest√£o:</label>
                            <select id="tipo" onchange="toggleAlternatives(this.value)" required>
                                <option value="M√∫ltipla Escolha">M√∫ltipla Escolha</option>
                                <option value="Discursiva">Discursiva</option>
                            </select>
                            
                            <div id="linhas-discursiva-group" style="display: none;">
                                <label for="linhas-discursiva">Linhas para Resposta Discursiva (padr√£o 4):</label>
                                <input type="number" id="linhas-discursiva" min="1" max="20" value="4">
                            </div>
                        </div>
                        <div>
                            <label for="enunciado">Enunciado da Quest√£o (Texto):</label>
                            <textarea id="enunciado" rows="5" required></textarea>
                            
                            <label for="enunciado-imagem">Imagem/M√≠dia para o Enunciado (Upload):</label>
                            <input type="file" id="enunciado-imagem" accept="image/*">
                        </div>
                    </div>
                    
                    <div id="alternatives-section">
                        <h3>Alternativas (M√∫ltipla Escolha)</h3>
                        <div id="alternatives-inputs" class="dashboard-grid" style="grid-template-columns: repeat(3, 1fr); gap: 15px;">
                            </div>
                        
                        <label for="resposta-correta">Resposta Correta:</label>
                        <select id="resposta-correta" required>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                        </select>
                    </div>

                    <button type="button" class="btn-primary" onclick="handleCreateQuestion()"><i class="fas fa-save"></i> Salvar Quest√£o no Banco</button>
                    <div id="question-creation-message" style="margin-top: 20px;"></div>
                </form>
            </section>
<!--/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner       ATECSEVEN TECNOLOGIA
 * @cnpj        63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */-->
            <section id="bank" class="page-section">
                <h2><i class="fas fa-database"></i> Banco de Quest√µes</h2>
                <div class="filter-container">
                    <input type="text" id="filter-bank-text" placeholder="Filtrar por Componente, Habilidade ou Enunciado..." onkeyup="filterQuestions()">
                    <select id="filter-bank-modalidade" onchange="filterQuestions()">
                       
                        <option value="Ensino Fundamental I">Ensino Fundamental I</option>
                        <option value="Ensino Fundamental II">Ensino Fundamental II</option>
                        <option value="Ensino M√©dio">Ensino M√©dio</option>
                    </select>
                </div>
                
                <button type="button" class="btn-success" onclick="selectAllQuestions(true)"><i class="fas fa-check-double"></i> Selecionar Todas</button>
                <button type="button" class="btn-secondary" onclick="selectAllQuestions(false)"><i class="fas fa-times-circle"></i> Desmarcar Todas</button>
                <button type="button" class="btn-success" onclick="sendSelectedToExam()" style="margin-bottom: 20px;"><i class="fas fa-paper-plane"></i> Enviar Selecionadas para a Prova</button>

                <ul id="questions-bank-list" class="exam-list">
                    <li>Carregando quest√µes...</li>
                </ul>
            </section>
            
            <section id="create-exam" class="page-section">
                <h2><i class="fas fa-file-export"></i> Gerar Nova Prova</h2>
                <form id="form-create-exam">
                    <h3>1. Detalhes do Cabe√ßalho</h3>
                    <div class="dashboard-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div>
                            <label for="cabecalho-escola">Nome da Institui√ß√£o/Escola:</label>
                            <input type="text" id="cabecalho-escola" required>

                            <label for="cabecalho-disciplina-select">Disciplina:</label>
                            <select id="cabecalho-disciplina-select" required onchange="filterQuestionsForExam()">
                                <option value="">Selecione a Disciplina</option>
                            </select>
                            
                            <label for="cabecalho-professor">Professor:</label>
                            <input type="text" id="cabecalho-professor" required disabled>
                            
                            <label for="cabecalho-periodo">Per√≠odo/Etapa (Ex: 1¬∫ Per√≠odo):</label>
                            <select id="cabecalho-periodo" required>
                                <option value="1¬∫ PER√çODO">1¬∫ PER√çODO</option>
                                <option value="2¬∫ PER√çODO">2¬∫ PER√çODO</option>
                                <option value="3¬∫ PER√çODO">3¬∫ PER√çODO</option>
                                <option value="4¬∫ PER√çODO">4¬∫ PER√çODO</option>
                            </select>
                        </div>
                        <div>
                            <label for="cabecalho-logo-file">Logo da Escola:</label>
                            <input type="file" id="cabecalho-logo-file" accept="image/*">
                            
                            <label for="cabecalho-turma">Turma:</label>
                            <input type="text" id="cabecalho-turma" required>

                            <label for="cabecalho-turno">Turno:</label>
                            <select id="cabecalho-turno">
                                <option value="Matutino">Matutino</option>
                                <option value="Vespertino">Vespertino</option>
                                <option value="Noturno">Noturno</option>
                            </select>
                            
                            <label for="cabecalho-data-prova">Data da Prova (para o cabe√ßalho):</label>
                            <input type="date" id="cabecalho-data-prova" required>
                        </div>
                    </div>
                    
                    <label for="layout">Layout da Prova na Impress√£o/PDF:</label>
                    <select id="layout">
                        <option value="1">1 Coluna (Recomendado)</option>
                        <option value="2">2 Colunas (Fiel ao Modelo Anexo)</option>
                    </select>
                    
                    <label for="instrucoes">Instru√ß√µes Gerais (Aparecer√£o na prova):</label>
                    <textarea id="instrucoes" rows="3">Leia atentamente todas as quest√µes antes de responder. Use caneta azul ou preta e evite rasuras.</textarea>

                    <h3 style="margin-top: 30px;">3. Quest√µes Selecionadas</h3>
                    <div id="selected-questions-from-bank" class="alert-info" style="margin-bottom: 20px; display: none;">
                        <i class="fas fa-info-circle"></i> **Quest√µes carregadas do Banco.** Clique em "Gerar Prova" para finalizar.
                    </div>
                    
                    <button type="button" class="btn-warning" onclick="shuffleSelectedQuestions()" style="margin-bottom:10px;"><i class="fas fa-random"></i> Embaralhar Quest√µes</button>

                    <div id="exam-questions-list" style="border: 1px solid #ddd; padding: 15px; max-height: 400px; overflow-y: auto;">
                        <p>Selecione uma disciplina acima ou use o Banco de Quest√µes para carregar as quest√µes.</p>
                    </div>

                    <button type="button" class="btn-primary" onclick="handleCreateExam()"><i class="fas fa-bolt"></i> Gerar Prova e Gabarito</button>
                    <div id="exam-creation-message" style="margin-top: 20px;"></div>
                </form>
            </section>

            <section id="my-exams" class="page-section">
                <h2><i class="fas fa-clipboard-list"></i> Minhas Provas Geradas</h2>
                <div class="filter-container">
                    <input type="text" id="filter-exams-text" placeholder="Filtrar por Disciplina, Turma ou Data/Hora de Gera√ß√£o..." onkeyup="filterExams()">
                </div>
                <ul id="my-exams-list" class="exam-list">
                    <li>Carregando provas...</li>
                </ul>
                
                <div id="exam-details-view" style="margin-top: 40px; border-top: 1px solid #ddd; display: none;">
                    <h3 id="selected-exam-name"></h3>
                    <div id="exam-actions" style="margin-bottom: 20px;">
                        <button class="action-button btn-primary" onclick="visualizarProvaDetalhe()"><i class="fas fa-eye"></i> Pr√©-Visualizar</button>
                        <button class="action-button btn-secondary" onclick="openEditExamModal()"><i class="fas fa-edit"></i> Editar Cabe√ßalho</button>
                        <button class="action-button btn-danger" onclick="deleteExam()"><i class="fas fa-trash"></i> Excluir</button>
                        
                        <div style="margin-top: 15px;">
                            <button class="action-button btn-primary" onclick="exportarProva('pdf')"><i class="fas fa-file-pdf"></i> Exportar Prova (PDF)</button>
                            <button class="action-button btn-secondary" onclick="baixarGabarito()"><i class="fas fa-file-alt"></i> Baixar Gabarito (TXT)</button>
                        </div>
                    </div>
                    
                    <div id="exam-preview" style="display: none; border: 1px solid #ddd; padding: 20px; max-width: 210mm; margin: 20px auto; background: white;">
                        <div id="exam-content-print">
                            </div>
                    </div>
                </div>
            </section>
            <!--/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner       ATECSEVEN TECNOLOGIA
 * @cnpj        63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */-->
<section id="admin" class="page-section admin-optimized">
    <style>
        .admin-optimized { max-width: 1400px !important; margin: 20px auto; padding: 25px !important; }
        .admin-top-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px; }
        .admin-card-box { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; }
        
        .admin-card-box h3 { 
            font-size: 0.9rem; color: #3f51b5; display: flex; 
            align-items: center; justify-content: space-between; 
            border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; 
            text-transform: uppercase; margin-bottom: 20px; 
        }

        .btn-refresh { 
            background: none; border: none; color: #3f51b5; 
            cursor: pointer; font-size: 1.1rem; transition: 0.3s; 
            padding: 5px; display: flex; align-items: center;
        }
        .btn-refresh:hover { color: #10b981; transform: scale(1.1); }

        .internal-form { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .full-span { grid-column: span 2; }
        .internal-form input, .internal-form select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #cbd5e1; box-sizing: border-box; }

        .user-table { width: 100%; border-collapse: collapse; table-layout: fixed; margin-top: 10px; }
        .user-table th, .user-table td { padding: 12px; border-bottom: 1px solid #f1f5f9; text-align: left; font-size: 0.85rem; }
        .col-nome { width: 25%; } .col-email { width: 20%; } .col-nivel { width: 10%; } .col-status { width: 10%; } .col-acoes { width: 35%; text-align: right !important; }

        .btn-action-group { display: flex; gap: 5px; justify-content: flex-end; flex-wrap: wrap; }
        .btn-sm-text { padding: 5px 10px; font-size: 0.75rem; border-radius: 4px; border: none; cursor: pointer; display: flex; align-items: center; gap: 4px; font-weight: 600; color: white; transition: 0.3s; }
        .btn-edit { background-color: #6366f1; }
        .btn-approve { background-color: #10b981; }
        .btn-suspend { background-color: #f59e0b; }
        .btn-delete { background-color: #ef4444; }

        .status-badge { font-weight: bold; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; }
        .status-Aprovado { color: #10b981; }
        .status-Pendente { color: #f59e0b; }
        .status-Suspenso { color: #ef4444; }

        .pending-item { background: white; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
    </style>

    <h2><i class="fas fa-user-shield"></i> Painel Administrativo</h2>
    
    <div class="admin-top-grid">
        <div class="admin-card-box">
            <h3><span><i class="fas fa-user-edit"></i> Cadastro / Edi√ß√£o</span></h3>
            <div class="internal-form" id="admin-form">
                <input type="hidden" id="edit-user-id">
                <input type="text" id="new-user-name" class="full-span" placeholder="Nome Completo">
                <input type="text" id="new-user-school" class="full-span" placeholder="Escola">
                <input type="email" id="new-user-email" placeholder="E-mail">
                <input type="text" id="new-user-password" placeholder="Senha"> 
                <select id="new-user-role" class="full-span">
                    <option value="ADM">Administrador</option>
                    <option value="Professor">Professor</option>
                </select>
                <button type="button" class="btn-primary full-span" id="btn-save-user">Salvar Usu√°rio</button>
                <button type="button" class="btn-secondary full-span" id="btn-cancel-edit" style="display:none;">Cancelar Edi√ß√£o</button>
            </div>
        </div>

        <div class="admin-card-box">
            <h3>
                <span><i class="fas fa-user-clock"></i> Pendentes de Aprova√ß√£o</span>
                <button class="btn-refresh" onclick="window.refreshData()"><i class="fas fa-sync-alt"></i></button>
            </h3>
            <div id="pending-users-list">
                <p style="text-align:center; color:#94a3b8;">Buscando dados...</p>
            </div>
        </div>
    </div>

    <div class="active-users-section">
        <div class="management-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin:0;"><i class="fas fa-users"></i> Gerenciar Todos os Usu√°rios</h3>
            <div class="search-container" style="position: relative; width: 300px;">
                <input type="text" id="admin-search" placeholder="Buscar..." style="width:100%; padding:8px 10px; border-radius:6px; border:1px solid #ddd;" onkeyup="filterTable()">
            </div>
        </div>
        <table class="user-table">
            <thead>
                <tr>
                    <th class="col-nome">Nome / Escola</th>
                    <th class="col-email">E-mail</th>
                    <th class="col-nivel">N√≠vel</th>
                    <th class="col-status">Status</th>
                    <th class="col-acoes">A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="users-table-body"></tbody>
        </table>
    </div>
</section>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, remove, push, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDFQCMsX04fwh7MVyEpvXnXD0U4TD5Or5w",
        authDomain: "ja-barbearia.firebaseapp.com",
        databaseURL: "https://ja-barbearia-default-rtdb.firebaseio.com",
        projectId: "ja-barbearia",
        storageBucket: "ja-barbearia.firebasestorage.app",
        messagingSenderId: "213237027963",
        appId: "1:213237027963:web:7d585b158ee06d3ab7fede"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function renderizarPainel(snapshot) {
        const tableBody = document.getElementById('users-table-body');
        const pendingList = document.getElementById('pending-users-list');
        
        tableBody.innerHTML = '';
        pendingList.innerHTML = '';
        let hasPending = false;

        snapshot.forEach((child) => {
            const user = child.val();
            const id = child.key;
            const status = user.status || "Pendente";
            const nivel = user.cargo || user.role || "Professor";

            if (status === "Pendente") {
                hasPending = true;
                pendingList.innerHTML += `
                    <div class="pending-item">
                        <div><strong>${user.nome}</strong><br><small>${user.email}</small></div>
                        <button class="btn-sm-text btn-approve" onclick="window.updateStatus('${id}', 'Aprovado')">APROVAR</button>
                    </div>`;
            }

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><strong>${user.nome}</strong><br><small>${user.escola || ''}</small></td>
                <td>${user.email}</td>
                <td>${nivel}</td>
                <td><span class="status-badge status-${status}">${status}</span></td>
                <td class="col-acoes">
                    <div class="btn-action-group">
                        ${status !== 'Aprovado' ? `<button class="btn-sm-text btn-approve" onclick="window.updateStatus('${id}', 'Aprovado')">APROVAR</button>` : ''}
                        <button class="btn-sm-text btn-edit" onclick="window.editUser('${id}')">EDITAR</button>
                        <button class="btn-sm-text btn-suspend" onclick="window.updateStatus('${id}', 'Suspenso')">SUSPENDER</button>
                        <button class="btn-sm-text btn-delete" onclick="window.deleteUser('${id}')">EXCLUIR</button>
                    </div>
                </td>`;
            tableBody.appendChild(tr);
        });

        if (!hasPending) pendingList.innerHTML = '<p style="text-align:center; color:#94a3b8;">Nenhum pendente.</p>';
    }

    window.refreshData = () => {
        const icon = document.querySelector('.btn-refresh i');
        icon.classList.add('fa-spin');
        get(ref(db, 'usuarios')).then((snapshot) => {
            renderizarPainel(snapshot);
            setTimeout(() => icon.classList.remove('fa-spin'), 600);
        });
    };

    onValue(ref(db, 'usuarios'), (snapshot) => renderizarPainel(snapshot));

    window.updateStatus = (id, newStatus) => update(ref(db, `usuarios/${id}`), { status: newStatus });
    
    window.deleteUser = (id) => confirm("Excluir?") && remove(ref(db, `usuarios/${id}`));

    window.editUser = (id) => {
        get(ref(db, `usuarios/${id}`)).then((snap) => {
            const user = snap.val();
            document.getElementById('edit-user-id').value = id;
            document.getElementById('new-user-name').value = user.nome;
            document.getElementById('new-user-school').value = user.escola || '';
            document.getElementById('new-user-email').value = user.email;
            document.getElementById('new-user-password').value = user.password_hash || '';
            document.getElementById('new-user-role').value = user.role || user.cargo || 'Professor';
            document.getElementById('btn-save-user').innerText = "Atualizar Cadastro";
            document.getElementById('btn-cancel-edit').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    };

    document.getElementById('btn-save-user').onclick = async () => {
        const id = document.getElementById('edit-user-id').value;
        const data = {
            nome: document.getElementById('new-user-name').value,
            escola: document.getElementById('new-user-school').value,
            email: document.getElementById('new-user-email').value,
            password_hash: document.getElementById('new-user-password').value,
            role: document.getElementById('new-user-role').value,
            status: "Aprovado"
        };
        if(id) await update(ref(db, `usuarios/${id}`), data);
        else await push(ref(db, 'usuarios'), { ...data, data_solicitacao: new Date().toISOString() });
        resetForm();
    };

    function resetForm() {
        document.getElementById('edit-user-id').value = '';
        document.querySelectorAll('#admin-form input').forEach(i => i.value = '');
        document.getElementById('btn-save-user').innerText = "Salvar Usu√°rio";
        document.getElementById('btn-cancel-edit').style.display = 'none';
    }

    window.filterTable = () => {
        const term = document.getElementById('admin-search').value.toLowerCase();
        document.querySelectorAll('#users-table-body tr').forEach(r => {
            r.style.display = r.innerText.toLowerCase().includes(term) ? '' : 'none';
        });
    };
    
    document.getElementById('btn-cancel-edit').onclick = resetForm;
</script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, remove, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDFQCMsX04fwh7MVyEpvXnXD0U4TD5Or5w",
        authDomain: "ja-barbearia.firebaseapp.com",
        databaseURL: "https://ja-barbearia-default-rtdb.firebaseio.com",
        projectId: "ja-barbearia",
        storageBucket: "ja-barbearia.firebasestorage.app",
        messagingSenderId: "213237027963",
        appId: "1:213237027963:web:7d585b158ee06d3ab7fede"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Renderiza√ß√£o Real-time
    onValue(ref(db, 'usuarios'), (snapshot) => {
        const tableBody = document.getElementById('users-table-body');
        const pendingList = document.getElementById('pending-users-list');
        tableBody.innerHTML = '';
        pendingList.innerHTML = '';
        let hasPending = false;

        snapshot.forEach((child) => {
            const user = child.val();
            const id = child.key;
            const statusStr = String(user.status);

            // Se√ß√£o de Pendentes
            if (statusStr.trim() === "Pendente") {
                hasPending = true;
                pendingList.innerHTML += `
                    <div class="pending-item">
                        <div><strong>${user.nome}</strong><br><small>${user.email}</small></div>
                        <button class="btn-sm-text btn-approve" onclick="window.updateStatus('${id}', 'Aprovado')">Aprovar</button>
                    </div>`;
            }

            // Tabela Geral
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><strong>${user.nome}</strong><br><small>${user.escola || ''}</small></td>
                <td>${user.email}</td>
                <td><span class="role-tag ${user.role === 'ADM' ? 'tag-adm' : 'tag-prof'}">${user.role}</span></td>
                <td><span class="status-badge status-${user.status}">${user.status}</span></td>
                <td>
                    <div class="btn-action-group">
                        ${user.status !== 'Aprovado' ? `<button class="btn-sm-text btn-approve" onclick="window.updateStatus('${id}', 'Aprovado')"><i class="fas fa-check"></i> Aprovar</button>` : ''}
                        <button class="btn-sm-text btn-edit" onclick="window.editUser('${id}')"><i class="fas fa-edit"></i> Editar</button>
                        <button class="btn-sm-text btn-suspend" onclick="window.updateStatus('${id}', 'Suspenso')"><i class="fas fa-ban"></i> Suspender</button>
                        <button class="btn-sm-text btn-delete" onclick="window.deleteUser('${id}')"><i class="fas fa-trash"></i> Excluir</button>
                    </div>
                </td>`;
            tableBody.appendChild(tr);
        });

        if (!hasPending) pendingList.innerHTML = '<p style="text-align:center; color:#94a3b8;">Nenhum pendente encontrado.</p>';
    });

    // A√ß√µes
    window.updateStatus = (id, newStatus) => update(ref(db, `usuarios/${id}`), { status: newStatus });
    window.deleteUser = (id) => confirm("Excluir usu√°rio permanentemente?") && remove(ref(db, `usuarios/${id}`));

    window.editUser = (id) => {
        onValue(ref(db, `usuarios/${id}`), (snap) => {
            const user = snap.val();
            document.getElementById('edit-user-id').value = id;
            document.getElementById('new-user-name').value = user.nome;
            document.getElementById('new-user-school').value = user.escola || '';
            document.getElementById('new-user-email').value = user.email;
            document.getElementById('new-user-password').value = user.password_hash || ''; // Puxa a senha do banco
            document.getElementById('new-user-role').value = user.role;
            
            document.getElementById('btn-save-user').innerText = "Atualizar Usu√°rio";
            document.getElementById('btn-cancel-edit').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }, { onlyOnce: true });
    };

    document.getElementById('btn-save-user').onclick = async () => {
        const id = document.getElementById('edit-user-id').value;
        const data = {
            nome: document.getElementById('new-user-name').value.toUpperCase(),
            escola: document.getElementById('new-user-school').value.toUpperCase(),
            email: document.getElementById('new-user-email').value,
            password_hash: document.getElementById('new-user-password').value,
            role: document.getElementById('new-user-role').value,
            cargo: document.getElementById('new-user-role').value === 'ADM' ? 'ADMINISTRADOR' : 'PROFESSOR',
            status: "Aprovado" // Ao salvar/editar vira aprovado por padr√£o
        };

        if(id) await update(ref(db, `usuarios/${id}`), data);
        else await push(ref(db, 'usuarios'), { ...data, data_solicitacao: new Date().toISOString() });
        
        resetForm();
    };

    document.getElementById('btn-cancel-edit').onclick = resetForm;

    function resetForm() {
        document.getElementById('edit-user-id').value = '';
        document.querySelectorAll('#admin-form input').forEach(i => i.value = '');
        document.getElementById('btn-save-user').innerText = "Salvar Usu√°rio";
        document.getElementById('btn-cancel-edit').style.display = 'none';
    }

    window.filterTable = () => {
        const term = document.getElementById('admin-search').value.toLowerCase();
        const rows = document.querySelectorAll('#users-table-body tr');
        rows.forEach(r => r.style.display = r.innerText.toLowerCase().includes(term) ? '' : 'none');
    };
</script>
            
        </main>
        
        <footer>
            By Atecseven tecnologia - www.atecseven.com.br - CNPJ 63.373.374/0001-72
        </footer>
    </div>
    
    <div id="print-area-container">
        </div>

    <div id="modal-request-access" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-btn" onclick="closeModal('modal-request-access')">&times;</span>
            <h3><i class="fas fa-user-plus"></i> Solicitar Acesso</h3>
            
            <p class="alert-info"><i class="fas fa-info-circle"></i> Sua solicita√ß√£o ser√° enviada para aprova√ß√£o do Administrador.</p>
            
            <form id="form-request-access" onsubmit="return false;">
                <label for="access-name">Nome Completo:</label>
                <input type="text" id="access-name" required>

                <label for="access-cargo">Cargo/Fun√ß√£o:</label>
                <input type="text" id="access-cargo" required>

                <label for="access-escola">Nome da Escola/Institui√ß√£o:</label>
                <input type="text" id="access-escola" required>

                <label for="access-email">E-mail (Ser√° seu login):</label>
                <input type="email" id="access-email" required>
                
                <label for="access-password">Senha:</label>
                <input type="password" id="access-password" required>
                
                <button type="button" class="btn-primary" onclick="handleRequestAccess()"><i class="fas fa-paper-plane"></i> Enviar Solicita√ß√£o</button>
            </form>
            <div id="request-access-message" style="margin-top: 10px;"></div>
        </div>
    </div>
<!--/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner       ATECSEVEN TECNOLOGIA
 * @cnpj        63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */-->

    <div id="modal-question-view" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('modal-question-view')">&times;</span>
            <h3 id="modal-question-title">Visualizar Quest√£o Q0</h3>
            
            <div id="modal-question-content" class="question-view-grid">
                <div>
                    <h4>Enunciado</h4>
                    <p id="modal-enunciado-text"></p>
                    <img id="modal-enunciado-image" class="question-image-preview" alt="Imagem do Enunciado" style="display: none;">
                </div>
                
                <div>
                    <h4>Alternativas / Gabarito</h4>
                    <form id="modal-gabarito-form">
                        <ul id="modal-alternatives-list" class="alternatives-list">
                            </ul>
                        <p>Resposta Correta Atual: <strong id="modal-resposta-correta-atual"></strong></p>
                        <input type="hidden" id="modal-question-id">
                        <button type="button" class="btn-primary" onclick="saveNewAnswer()"><i class="fas fa-check"></i> Salvar Nova Alternativa</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-question-edit" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <span class="close-btn" onclick="closeModal('modal-question-edit')">&times;</span>
            <h3 id="modal-edit-question-title">Editar Quest√£o Q0</h3>

            <form id="form-edit-question">
                <input type="hidden" id="edit-question-firebaseId">
                <input type="hidden" id="edit-question-id-sequencial">
                
                <div class="dashboard-grid" style="grid-template-columns: repeat(2, 1fr);">
                    <div>
                        <label for="edit-modalidade">Modalidade de Ensino:</label>
                        <select id="edit-modalidade" required>
                            <option value="Ensino Fundamental I">Ensino Fundamental I</option>
                            <option value="Ensino Fundamental II">Ensino Fundamental II</option>
                            <option value="Ensino M√©dio">Ensino M√©dio</option>
                        </select>

                        <label for="edit-componente">Componente Curricular:</label>
                        <input type="text" id="edit-componente" placeholder="Ex: Matem√°tica, Portugu√™s, Ci√™ncias" required>
                        
                        <label for="edit-habilidade">Habilidade BNCC (D-XX):</label>
                        <input type="text" id="edit-habilidade" placeholder="Ex: D 33">
                        
                        <label for="edit-tipo">Tipo de Quest√£o:</label>
                        <select id="edit-tipo" onchange="toggleEditAlternatives(this.value)" required>
                            <option value="M√∫ltipla Escolha">M√∫ltipla Escolha</option>
                            <option value="Discursiva">Discursiva</option>
                        </select>
                        
                         <div id="edit-linhas-discursiva-group" style="display: none;">
                            <label for="edit-linhas-discursiva">Linhas para Resposta Discursiva (padr√£o 4):</label>
                            <input type="number" id="edit-linhas-discursiva" min="1" max="20" value="4">
                        </div>

                    </div>
                    <div>
                        <label for="edit-enunciado">Enunciado da Quest√£o (Texto):</label>
                        <textarea id="edit-enunciado" rows="5" required></textarea>
                        
                        <label for="edit-enunciado-imagem">Imagem/M√≠dia para o Enunciado (Selecione um novo arquivo para substituir):</label>
                        <input type="file" id="edit-enunciado-imagem" accept="image/*">
                        <div id="edit-enunciado-image-preview-container">
                             <small>Imagem Atual:</small>
                             <img id="edit-enunciado-image-preview" class="image-preview-edit" alt="Imagem Enunciado Atual" style="display: none;">
                        </div>
                    </div>
                </div>
<!--/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner       ATECSEVEN TECNOLOGIA
 * @cnpj        63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */-->
                <div id="edit-alternatives-section">
                    <h3 style="margin-top: 30px;">Edi√ß√£o de Alternativas</h3>
                    <div id="edit-alternatives-inputs" class="dashboard-grid" style="grid-template-columns: repeat(3, 1fr); gap: 15px;">
                        </div>
                    
                    <label for="edit-resposta-correta">Resposta Correta:</label>
                    <select id="edit-resposta-correta" required>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                    </select>
                </div>

                <button type="button" class="btn-primary" style="margin-top: 20px;" onclick="handleEditQuestionSave()"><i class="fas fa-save"></i> Salvar Edi√ß√£o da Quest√£o</button>
                <div id="question-edit-message" style="margin-top: 20px;"></div>
            </form>
        </div>
    </div>


    <div id="modal-edit-exam" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('modal-edit-exam')">&times;</span>
            <h3>Editar Prova <span id="modal-edit-exam-name"></span></h3>
            
            <p class="alert-info"><i class="fas fa-info-circle"></i> Edi√ß√£o de Cabe√ßalho: Para alterar quest√µes, exclua e gere uma nova prova.</p>
            
            <form id="form-edit-exam">
                <label for="edit-escola">Nome da Escola:</label>
                <input type="text" id="edit-escola" required>
                
                <label for="edit-turma">Turma:</label>
                <input type="text" id="edit-turma" required>
                
                <label for="edit-professor">Professor:</label>
                <input type="text" id="edit-professor" required>
                
                <label for="edit-duracao">Dura√ß√£o:</label>
                <input type="text" id="edit-duracao" required>
                
                <label for="edit-data-prova">Data da Prova:</label>
                <input type="date" id="edit-data-prova" required>
                
                <button type="button" class="btn-primary" onclick="handleEditExamSave()"><i class="fas fa-save"></i> Salvar Altera√ß√µes</button>
            </form>
            <div id="edit-exam-message" style="margin-top: 10px;"></div>
        </div>
    </div>
<!--/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner       ATECSEVEN TECNOLOGIA
 * @cnpj        63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */-->

    <script>
      /**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
    const IMGBB_KEY = "95bb16ee776d7e20f26857cec98bd372";
    /**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
    const firebaseConfig = {
        apiKey: "AIzaSyDFQCMsX04fwh7MVyEpvXnXD0U4TD5Or5w",
        authDomain: "ja-barbearia.firebaseapp.com",
        databaseURL: "https://ja-barbearia-default-rtdb.firebaseio.com",
        projectId: "ja-barbearia",
        appId: "1:213237027963:web:7d585b158ee06d3ab7fede",
        measurementId: "G-YNNKX5YDDN"  
    };
/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
    const app = firebase.initializeApp(firebaseConfig);
    const database = app.database();

    let CURRENT_USER = null;    
    let CURRENT_USER_ID = null;
    let CURRENT_USER_ROLE = 'Padr√£o';    
    let allUsers = {};  
    let allExams = {};  
    let allQuestions = {};  
    let selectedExamId = null;
    let selectedQuestionIdsForExam = [];

    const ALTERNATIVE_LETTERS = ['A', 'B', 'C', 'D', 'E'];
    const LINE_HEIGHT_PT = 14;  
/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
    let PAGE_SIZE = 20; 
    let lastKey = null; 
    let isSearching = false; 

    async function uploadFileToImgBB(file) {
        if (!file) return "";

        const formData = new FormData();
        formData.append("image", file);
        
        const url = `https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`;

        try {
            const response = await fetch(url, {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                throw new Error(`Erro de rede ou falha no upload: ${response.statusText}`);
            }
            
            const data = await response.json();

            if (data.success) {
                return data.data.url;
            } else {
                throw new Error(data.error.message || "Erro desconhecido no ImgBB.");
            }
        } catch (error) {
            console.error("Erro no upload para ImgBB:", error);
            throw new Error(`Falha no upload da imagem. Erro: ${error.message}`);
        }
    }
    /**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
    async function handleLogin() {
        const email = document.getElementById('login-user').value;
        const password = document.getElementById('login-password').value;
        const messageEl = document.getElementById('login-message');
        messageEl.innerHTML = '<i class="fas fa-sync fa-spin"></i> Verificando credenciais...';
        
        try {
            const userSnapshot = await database.ref('usuarios').orderByChild('email').equalTo(email).once('value');
            
            if (!userSnapshot.exists()) {
                 messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-exclamation-circle"></i> Usu√°rio n√£o encontrado.</div>`;
                 return;
            }

            let userId = null;
            let userDetails = null;

            userSnapshot.forEach(child => {
                userId = child.key;
                userDetails = child.val();
            });

            if (userDetails && userDetails.password_hash === password) {
                
                if (userDetails.status === 'Pendente') {
                    messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-user-clock"></i> Seu acesso est√° pendente de aprova√ß√£o pelo administrador.</div>`;
                    return;
                }

                CURRENT_USER_ID = userId;
                CURRENT_USER_ROLE = userDetails.role;
                CURRENT_USER = userDetails;

                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-interface').style.display = 'flex';
                
                const nome = userDetails.nome || userDetails.email;
                const userInfoDisplay = document.getElementById('user-info-display');
                if (userInfoDisplay) {
                    userInfoDisplay.textContent = ` | Seja Bem-Vindo ${nome}!`;
                }
                
                document.getElementById('user-role-display').textContent = `[${CURRENT_USER_ROLE}]`;
                
                if (CURRENT_USER_ROLE === 'ADM') {
                    document.getElementById('nav-admin').style.display = 'list-item';
                } else {
                    document.getElementById('nav-admin').style.display = 'none';
                }
                
                document.getElementById('cabecalho-professor').value = nome;
                document.getElementById('cabecalho-professor').disabled = true;

                await updateDashboardIndicators();
                showPage('dashboard');

            } else {
                messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-exclamation-circle"></i> Senha incorreta.</div>`;
            }

        } catch (error) {
            console.error("Erro no login:", error);
            messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-radiation-alt"></i> Erro de conex√£o: ${error.message}</div>`;
        }
    }
    
    async function handleRequestAccess() {
        const name = document.getElementById('access-name').value;
        const cargo = document.getElementById('access-cargo').value;
        const escola = document.getElementById('access-escola').value;
        const email = document.getElementById('access-email').value;
        const password = document.getElementById('access-password').value;

        const messageEl = document.getElementById('request-access-message');
        messageEl.innerHTML = '';

        if (!name || !cargo || !escola || !email || !password) {
            messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-exclamation-triangle"></i> Todos os campos s√£o obrigat√≥rios.</div>`;
            return;
        }
        
        try {
            const existingUserSnapshot = await database.ref('usuarios').orderByChild('email').equalTo(email).once('value');
            if (existingUserSnapshot.exists()) {
                 messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-user-lock"></i> Este e-mail j√° est√° cadastrado. Tente entrar.</div>`;
                 return;
            }
/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
            const newUserRef = database.ref('usuarios').push();
            await newUserRef.set({
                nome: name,
                cargo: cargo,
                escola: escola,
                email: email,
                password_hash: password,    
                role: 'Padr√£o',
                status: 'Pendente',
                data_solicitacao: new Date().toISOString()
            });
            
            messageEl.innerHTML = `<div class="alert-success"><i class="fas fa-check-circle"></i> Solicita√ß√£o enviada! Aguarde a aprova√ß√£o do administrador.</div>`;
            document.getElementById('form-request-access').reset();
            
        } catch (error) {
            messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-exclamation-circle"></i> Erro ao enviar solicita√ß√£o: ${error.message}</div>`;
        }
    }
    
    function showPage(pageId) {
        document.querySelectorAll('.page-section').forEach(section => {
            section.style.display = 'none';
        });
        document.getElementById(pageId).style.display = 'block';
        
        document.querySelectorAll('.nav-menu a').forEach(a => a.classList.remove('active'));
        document.getElementById(`nav-${pageId.replace('-', '')}`).classList.add('active');
        
        if (pageId === 'bank') {
            updateBankView();
        } else if (pageId === 'my-exams') {
            if(Object.keys(allExams).length === 0) updateExamListView();
            else filterExams();    
            document.getElementById('exam-details-view').style.display = 'none';
        } else if (pageId === 'admin') {
            if (CURRENT_USER_ROLE === 'ADM') {
                updateAdminViews();
            }
        } else if (pageId === 'dashboard') {
            updateDashboardIndicators();
        } else if (pageId === 'create-exam') {
            if(selectedQuestionIdsForExam.length > 0) {
                displaySelectedQuestionsForExam(selectedQuestionIdsForExam);
            } else {
                document.getElementById('selected-questions-from-bank').style.display = 'none';
                document.getElementById('exam-questions-list').innerHTML = '<p>Selecione uma disciplina acima ou use o Banco de Quest√µes para carregar as quest√µes.</p>';
            }
        }
    }

    function simularLogout() {
        CURRENT_USER = null;
        CURRENT_USER_ID = null;
        CURRENT_USER_ROLE = 'Padr√£o';
        document.getElementById('main-interface').style.display = 'none';
        document.getElementById('login-screen').style.display = 'flex';
        document.getElementById('login-user').value = '';    
        document.getElementById('login-password').value = '';
        document.getElementById('login-message').innerHTML = '';
        
        allQuestions = {};
        allExams = {};
    }

    function formatDateTimeBR(isoString) {
        if (!isoString) return 'N/A';
        const date = new Date(isoString);
        return date.toLocaleString('pt-BR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
        });
    }
    /**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
    function openModal(modalId) {
        document.getElementById(modalId).style.display = 'block';
    }
    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }
    
    async function getNextQuestionId() {
        const counterRef = database.ref('metadata/questionCounter');
        
        const { committed, snapshot } = await counterRef.transaction(currentValue => {
            return (currentValue || 0) + 1;
        });

        if (committed) {
            return snapshot.val();
        } else {
            const currentSnapshot = await counterRef.once('value');
            return currentSnapshot.val();    
        }
    }
    
    let originalUsersList = [];

    async function updateAdminViews() {
        try {
            const snapshot = await database.ref('usuarios').once('value');
            allUsers = snapshot.val() || {};
            
            originalUsersList = Object.entries(allUsers).map(([id, user]) => ({ id, ...user }));
            
            const totalPadrao = originalUsersList.filter(u => u.status === 'Aprovado' && u.role === 'Padr√£o').length;
            const totalAdm = originalUsersList.filter(u => u.status === 'Aprovado' && u.role === 'ADM').length;
            const totalPendentes = originalUsersList.filter(u => u.status === 'Pendente').length;
            
            document.getElementById('dash-total-padrao').textContent = totalPadrao;
            document.getElementById('dash-total-adm').textContent = totalAdm;
            document.getElementById('dash-total-pendentes').textContent = totalPendentes;
            
            filterUsers();
            
        } catch (e) {
            console.error("Erro ao carregar usu√°rios (ADM):", e);
        }
    }
    
    function filterUsers() {
        const pendingList = document.getElementById('pending-users-list');
        const activeList = document.getElementById('active-users-list');
        pendingList.innerHTML = '';
        activeList.innerHTML = '';
        
        const filterText = document.getElementById('filter-users-text').value.toLowerCase();
        
        const filteredUsers = originalUsersList.filter(u => u.email.toLowerCase().includes(filterText));
        
        const pending = filteredUsers.filter(u => u.status === 'Pendente');
        const active = filteredUsers.filter(u => u.status === 'Aprovado');
        
        if (pending.length === 0) pendingList.innerHTML = '<li>Nenhum usu√°rio pendente ou encontrado com o filtro.</li>';
        pending.forEach(u => {
            pendingList.innerHTML += `
                <li>
                    <span>${u.email} (Nome: ${u.nome || 'N/A'} | Escola: ${u.escola || 'N/A'})</span>
                    <div>
                        <button class="action-button btn-primary" onclick="changeUserStatus('${u.id}', 'Aprovado')"><i class="fas fa-check"></i> Aprovar</button>
                        <button class="action-button btn-danger" onclick="deleteUser('${u.id}')"><i class="fas fa-trash"></i> Excluir</button>
                    </div>
                </li>
            `;
        });
        
        if (active.length === 0) activeList.innerHTML = '<li>Nenhum usu√°rio ativo ou encontrado com o filtro.</li>';
        active.forEach(u => {
            activeList.innerHTML += `
                <li>
                    <span>${u.email} (Fun√ß√£o: ${u.role})</span>
                    <div>
                        <button class="action-button btn-secondary" onclick="resetUserPassword('${u.id}')"><i class="fas fa-redo"></i> Resetar Senha</button>
                        <button class="action-button btn-danger" onclick="deleteUser('${u.id}')"><i class="fas fa-trash"></i> Excluir</button>
                    </div>
                </li>
            `;
        });
    }

    async function handleCreateUser() {
        const name = document.getElementById('new-user-name').value;
        const email = document.getElementById('new-user-email').value;
        const password = document.getElementById('new-user-password').value;
        const role = document.getElementById('new-user-role').value;
        const messageEl = document.getElementById('create-user-message');
        messageEl.innerHTML = `<div class="alert-info"><i class="fas fa-sync fa-spin"></i> Criando usu√°rio...</div>`;
        
        try {
            const newUserRef = database.ref('usuarios').push();
            await newUserRef.set({
                nome: name,
                email: email,
                password_hash: password,    
                role: role,
                status: 'Aprovado',
                data_criacao: new Date().toISOString()
            });
            
            messageEl.innerHTML = `<div class="alert-success"><i class="fas fa-check-circle"></i> Usu√°rio ${email} criado com sucesso!</div>`;
            document.getElementById('form-create-user').reset();
            updateAdminViews();
        } catch (error) {
            messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-exclamation-circle"></i> Erro ao criar usu√°rio: ${error.message}</div>`;
        }
    }

    async function changeUserStatus(userId, status) {
        try {
            await database.ref(`usuarios/${userId}`).update({ status: status });
            alert(`Status do usu√°rio alterado para: ${status}`);
            updateAdminViews();
        } catch (e) {
            alert("Erro ao mudar status: " + e.message);
        }
    }

    async function resetUserPassword(userId) {
        const newPassword = prompt("Digite a nova senha para este usu√°rio:");
        if (newPassword) {
            try {
                await database.ref(`usuarios/${userId}`).update({ password_hash: newPassword });
                alert(`Senha resetada com sucesso! Nova senha: ${newPassword}`);
                updateAdminViews();
            } catch (e) {
                alert("Erro ao resetar senha: " + e.message);
            }
        }
    }

    async function deleteUser(userId) {
        if (confirm("Tem certeza que deseja EXCLUIR este usu√°rio?")) {
            try {
                await database.ref(`usuarios/${userId}`).remove();
                alert("Usu√°rio exclu√≠do com sucesso.");
                updateAdminViews();
            } catch (e) {
                alert("Erro ao excluir usu√°rio: " + e.message);
            }
        }
    }

    function setupAlternativeInputs() {
        const container = document.getElementById('alternatives-inputs');
        container.innerHTML = '';
        ALTERNATIVE_LETTERS.forEach(letra => {
            container.innerHTML += `
                <div>
                    <label for="alt${letra}"><strong>${letra})</strong> Texto:</label>
                    <input type="text" id="alt${letra}" placeholder="Texto da alternativa ${letra}" required>
                    <label for="img${letra}">M√≠dia ${letra} (Opcional):</label>
                    <input type="file" id="img${letra}" accept="image/*">
                </div>
            `;
        });
    }
    
    async function handleCreateQuestion() {
        const messageEl = document.getElementById('question-creation-message');
        messageEl.innerHTML = `<div class="alert-info"><i class="fas fa-sync fa-spin"></i> Processando... Uploads para ImgBB em andamento.</div>`;
        
        try {
            const nextId = await getNextQuestionId();
            
            const enunciadoFile = document.getElementById('enunciado-imagem').files[0];
            const enunciadoUrl = await uploadFileToImgBB(enunciadoFile);

            const tipo = document.getElementById('tipo').value;
            const linhasDiscursivaEl = document.getElementById('linhas-discursiva');
            const linhasDiscursiva = tipo === 'Discursiva' && linhasDiscursivaEl ? parseInt(linhasDiscursivaEl.value) : 0;
            
            const alternativas = [];
            if (tipo === 'M√∫ltipla Escolha') {
                for (const letra of ALTERNATIVE_LETTERS) {
                    const altText = document.getElementById(`alt${letra}`).value;
                    const altFile = document.getElementById(`img${letra}`).files[0];
                    let midiaUrl = "";
                    if (altFile) {
                        midiaUrl = await uploadFileToImgBB(altFile);
                    }
                    
                    alternativas.push({
                        letra: letra,
                        texto: altText,
                        midia: midiaUrl
                    });
                }
            }
            
            const novaQuestaoRef = database.ref('banco_questoes').push();
            const dadosQuestao = {
                id_sequencial: nextId,
                firebaseId: novaQuestaoRef.key,
                modalidade: document.getElementById('modalidade').value,
                componente_curricular: document.getElementById('componente').value,
                habilidade_bncc: document.getElementById('habilidade').value,
                enunciado: { texto: document.getElementById('enunciado').value, midia: enunciadoUrl || "" },
                tipo_questao: tipo,
                alternativas: alternativas,
                resposta_correta: tipo === 'M√∫ltipla Escolha' ? document.getElementById('resposta-correta').value : "Discursiva",
                linhas_discursiva: linhasDiscursiva,
                data_criacao: new Date().toISOString(),
                criado_por_uid: CURRENT_USER_ID
            };

            await novaQuestaoRef.set(dadosQuestao);
            
            messageEl.innerHTML = `<div class="alert-success"><i class="fas fa-check-circle"></i> Quest√£o Q${nextId} salva com sucesso! (Imagens no ImgBB)</div>`;
            document.getElementById('form-create-question').reset();
            setupAlternativeInputs();    
            updateBankView();
            updateDashboardIndicators();
            
        } catch (error) {
            console.error("Erro ao criar quest√£o:", error);
            messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-exclamation-circle"></i> Erro ao salvar a quest√£o: ${error.message}</div>`;
        }
    }
    
    // NOVO: Fun√ß√£o para renderizar as quest√µes no Banco de Quest√µes
    function displayQuestions(questoes) {
        const listEl = document.getElementById('questions-bank-list');
        
        // Ordena por ID Sequencial para exibi√ß√£o
        const questionsToDisplay = questoes.sort((a, b) => a.id_sequencial - b.id_sequencial);

        if (questionsToDisplay.length > 0) {
            questionsToDisplay.forEach(q => {
                const isChecked = selectedQuestionIdsForExam.includes(q.firebaseId);
                
                const listItem = document.createElement('li');
                listItem.setAttribute('data-id', q.firebaseId);
                listItem.innerHTML = `
                    <input type="checkbox" name="select_for_exam" value="${q.firebaseId}" ${isChecked ? 'checked' : ''} onchange="toggleQuestionSelection('${q.firebaseId}', this.checked)">
                    <div class="question-item-info">
                        <span><strong>Q${q.id_sequencial}</strong> (${q.componente_curricular} / ${q.modalidade}): ${q.enunciado.texto.substring(0, 70)}...</span>
                        <small>Resp: ${q.resposta_correta} | Habilidade: ${q.habilidade_bncc || 'N/A'}</small>
                    </div>
                    <div class="question-item-actions">
                        <button class="action-button btn-secondary btn-sm" onclick="openQuestionViewModal('${q.firebaseId}')"><i class="fas fa-eye"></i> Gabarito</button>
                        <button class="action-button btn-primary btn-sm" onclick="openQuestionEditModal('${q.firebaseId}')"><i class="fas fa-edit"></i> Editar Quest√£o</button>
                    </div>
                `;
                listEl.appendChild(listItem);
            });
        }
    }
/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
    // NOVO: Fun√ß√£o para adicionar o bot√£o "Carregar Mais"
    function addLoadMoreButton(hasNextPage) {
        const listEl = document.getElementById('questions-bank-list');
        
        const existingButton = document.querySelector('#bank #load-more-btn');
        if (existingButton) existingButton.remove();

        if (hasNextPage) {
            const loadMoreBtn = document.createElement('button');
            loadMoreBtn.id = 'load-more-btn';
            loadMoreBtn.className = 'btn-secondary';
            loadMoreBtn.style = 'margin-top: 20px; width: 100%;';
            loadMoreBtn.innerHTML = '<i class="fas fa-arrow-down"></i> Carregar Mais Quest√µes';
            loadMoreBtn.onclick = () => manageBankPagination(false); 
            
            listEl.parentNode.insertBefore(loadMoreBtn, listEl.nextSibling);
        }
    }

    // NOVO: Fun√ß√£o de Pagina√ß√£o Mestra
    async function manageBankPagination(reset = false) {
        if (isSearching && !reset) return; 
        isSearching = true;

        const listEl = document.getElementById('questions-bank-list');
        const filterText = document.getElementById('filter-bank-text').value.toLowerCase();
        const filterModalidade = document.getElementById('filter-bank-modalidade').value;
        
        if (reset) {
            lastKey = null;
            listEl.innerHTML = ''; 
        }
        
        if (listEl.children.length === 0) {
             listEl.innerHTML = '<li style="text-align:center;"><i class="fas fa-sync fa-spin"></i> Carregando quest√µes...</li>';
        }
        
        const existingButton = document.querySelector('#bank #load-more-btn');
        if (existingButton) existingButton.remove();

        try {
            let queryRef = database.ref('banco_questoes').orderByKey();
            
            if (lastKey) {
                queryRef = queryRef.startAt(lastKey);
            }
            
            queryRef = queryRef.limitToFirst(PAGE_SIZE + 1);

            const snapshot = await queryRef.once('value');
            let newQuestionsArray = [];
            let lastIdInPage = null; 

            snapshot.forEach(child => {
                const currentKey = child.key;
                
                if (lastKey && currentKey === lastKey && newQuestionsArray.length === 0 && !reset) {
                    return;
                }

                const q = { firebaseId: currentKey, ...child.val() };
                
                const modalidadeMatch = !filterModalidade || q.modalidade === filterModalidade;
                const textMatch = !filterText || 
                                    q.componente_curricular.toLowerCase().includes(filterText) ||
                                    (q.habilidade_bncc && q.habilidade_bncc.toLowerCase().includes(filterText)) ||
                                    q.enunciado.texto.toLowerCase().includes(filterText);

                if (modalidadeMatch && textMatch) {
                    newQuestionsArray.push(q);
                    allQuestions[currentKey] = q; 
                    lastIdInPage = currentKey;
                }
            });

            const totalItemsFetched = snapshot.numChildren();
            
            const hasNextPage = newQuestionsArray.length >= PAGE_SIZE;

            lastKey = hasNextPage ? lastIdInPage : null; 
            
            if(reset) {
                listEl.innerHTML = '';
            }
            /**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
            // Remove o item de controle do final do array se ele n√£o for o √∫ltimo item vis√≠vel
            if(newQuestionsArray.length > PAGE_SIZE) {
                newQuestionsArray.pop();
            }

            displayQuestions(newQuestionsArray);

            if (listEl.children.length === 0) {
                 listEl.innerHTML = '<li>Nenhuma quest√£o encontrada com os filtros aplicados.</li>';
            }

            addLoadMoreButton(hasNextPage);

        } catch (e) {
            listEl.innerHTML = `<li><div class="alert-error"><i class="fas fa-exclamation-triangle"></i> Erro ao carregar quest√µes: ${e.message}</div></li>`;
            console.error("Erro no manageBankPagination:", e);
        } finally {
            isSearching = false;
        }
    }

    async function updateBankView() {
        const snapshot = await database.ref('banco_questoes').once('value');
        allQuestions = snapshot.val() || {};
        
        const selectDisciplina = document.getElementById('cabecalho-disciplina-select');
        const disciplinas = new Set(Object.values(allQuestions).map(q => q.componente_curricular).filter(c => c));
        selectDisciplina.innerHTML = '<option value="">Selecione a Disciplina</option>';
        disciplinas.forEach(d => {
            selectDisciplina.innerHTML += `<option value="${d}">${d}</option>`;
        });
        
        manageBankPagination(true);
    }
    
    function selectAllQuestions(checked) {
        const checkboxes = document.querySelectorAll('#questions-bank-list input[type="checkbox"]');
        checkboxes.forEach(cb => {
            cb.checked = checked;
            toggleQuestionSelection(cb.value, checked);
        });
    }
/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
    function filterQuestions() {
        manageBankPagination(true);
    }
    
    function toggleQuestionSelection(questionId, isChecked) {
        if (isChecked) {
            if (!selectedQuestionIdsForExam.includes(questionId)) {
                selectedQuestionIdsForExam.push(questionId);
            }
        } else {
            selectedQuestionIdsForExam = selectedQuestionIdsForExam.filter(id => id !== questionId);
        }
    }

    function sendSelectedToExam() {
        if (selectedQuestionIdsForExam.length === 0) {
            alert("Selecione pelo menos uma quest√£o para enviar para a prova.");
            return;
        }
        
        displaySelectedQuestionsForExam(selectedQuestionIdsForExam);
        showPage('create-exam');
        
        alert(`${selectedQuestionIdsForExam.length} quest√£o(√µes) enviada(s) para a tela "Gerar Prova".`);
    }
    
    function displaySelectedQuestionsForExam(ids) {
        const listEl = document.getElementById('exam-questions-list');
        listEl.innerHTML = '';
        
        const questoesDetalhes = ids.map(id => allQuestions[id]).filter(q => q);
        
        if (questoesDetalhes.length > 0) {
            const disciplina = questoesDetalhes[0].componente_curricular;
            document.getElementById('cabecalho-disciplina-select').value = disciplina;
            document.getElementById('selected-questions-from-bank').style.display = 'block';
            document.getElementById('selected-questions-from-bank').innerHTML = `<i class="fas fa-info-circle"></i> <strong>Quest√µes carregadas do Banco.</strong> Disciplina: <strong>${disciplina}</strong>. Total: <strong>${questoesDetalhes.length}</strong>. Voc√™ pode desmarcar.`;

            listEl.innerHTML = '<h4><i class="fas fa-check-square"></i> Quest√µes Carregadas (Desmarque para remover):</h4><ul style="list-style: none; padding: 0;">';
            
            questoesDetalhes.forEach(q => {
                listEl.querySelector('ul').innerHTML += `
                    <li data-id="${q.firebaseId}">
                        <label>
                            <input type="checkbox" name="selected_questions" value="${q.firebaseId}" checked>
                            Q${q.id_sequencial} (${q.tipo_questao}): ${q.enunciado.texto.substring(0, 70)}...
                        </label>
                        <button class="action-button btn-secondary btn-sm" onclick="openQuestionViewModal('${q.firebaseId}')"><i class="fas fa-eye"></i> Visualizar</button>
                    </li>
                `;
            });
            listEl.innerHTML += '</ul>';
        } else {
            document.getElementById('selected-questions-from-bank').style.display = 'none';
            listEl.innerHTML = '<p class="alert-error"><i class="fas fa-exclamation-triangle"></i> Nenhuma quest√£o v√°lida selecionada ou carregada.</p>';
        }
    }
/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
    function shuffleSelectedQuestions() {
        if (selectedQuestionIdsForExam.length < 2) return alert("Adicione mais quest√µes para embaralhar.");
        
        for (let i = selectedQuestionIdsForExam.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [selectedQuestionIdsForExam[i], selectedQuestionIdsForExam[j]] = [selectedQuestionIdsForExam[j], selectedQuestionIdsForExam[i]];
        }
        
        displaySelectedQuestionsForExam(selectedQuestionIdsForExam);
        alert("Quest√µes embaralhadas!");
    }


    function filterQuestionsForExam() {
        const selectedDiscipline = document.getElementById('cabecalho-disciplina-select').value;
        
        if (selectedQuestionIdsForExam.length > 0) return;
        
        const examListEl = document.getElementById('exam-questions-list');
        examListEl.innerHTML = '';
        document.getElementById('selected-questions-from-bank').style.display = 'none';

        if (!selectedDiscipline) {
            examListEl.innerHTML = '<p class="alert-info"><i class="fas fa-arrow-up"></i> Selecione uma disciplina acima para carregar as quest√µes.</p>';
            return;
        }
        
        const questoesArray = Object.values(allQuestions).sort((a, b) => a.id_sequencial - b.id.sequencial);
        
        const questoesFiltradas = questoesArray.filter(q => q.componente_curricular === selectedDiscipline);

        if (questoesFiltradas.length > 0) {
            examListEl.innerHTML = '<h4><i class="fas fa-check-square"></i> Marque as quest√µes desejadas:</h4><ul style="list-style: none; padding: 0;">';
            
            questoesFiltradas.forEach(q => {
                examListEl.querySelector('ul').innerHTML += `
                    <li data-id="${q.firebaseId}">
                        <label>
                            <input type="checkbox" name="selected_questions" value="${q.firebaseId}">
                            Q${q.id_sequencial} (${q.tipo_questao}): ${q.enunciado.texto.substring(0, 70)}...
                        </label>
                        <button class="action-button btn-secondary btn-sm" onclick="openQuestionViewModal('${q.firebaseId}')"><i class="fas fa-eye"></i> Visualizar</button>
                    </li>
                `;
            });
            examListEl.innerHTML += '</ul>';
        } else {
            examListEl.innerHTML = `<p class="alert-error"><i class="fas fa-exclamation-triangle"></i> Nenhuma quest√£o cadastrada para a disciplina <strong>${selectedDiscipline}</strong>.</p>`;
        }
    }
    /**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
    function gerarGabaritoInstantaneo(questoes) {
        let gabarito = "--- GABARITO OFICIAL ---\n";
        gabarito += "Disciplina: " + (questoes[0]?.componente_curricular || 'N/A') + "\n";
        gabarito += "Total de Quest√µes: " + questoes.length + "\n\n";
        
        questoes.forEach((q, index) => {
            gabarito += `Q${index + 1}: ${q.resposta_correta} (${q.tipo_questao})\n`;
        });
        
        return gabarito;
    }


    async function handleCreateExam() {
        const messageEl = document.getElementById('exam-creation-message');
        messageEl.innerHTML = `<div class="alert-info"><i class="fas fa-sync fa-spin"></i> Processando upload da logo (ImgBB) e gera√ß√£o da prova...</div>`;
        
        try {
            // 1. Valida√ß√£o e Coleta das Quest√µes Marcadas
            const finalSelectedIds = Array.from(document.querySelectorAll('#exam-questions-list input[name="selected_questions"]:checked')).map(cb => cb.value);

            if (finalSelectedIds.length === 0) {
                throw new Error("Selecione pelo menos uma quest√£o para criar a prova.");
            }

            // 2. Upload da Logo
            const logoFile = document.getElementById('cabecalho-logo-file').files[0];
            let logoUrl = "";
            if (logoFile) {
                 logoUrl = await uploadFileToImgBB(logoFile);
            }
            
            // Coletando vari√°veis com seguran√ßa
            const disciplina = document.getElementById('cabecalho-disciplina-select')?.value || '';
            const dataProva = document.getElementById('cabecalho-data-prova')?.value || '';
            const periodo = document.getElementById('cabecalho-periodo')?.value || '';
            const duracao = document.getElementById('cabecalho-duracao')?.value || '';
            const escola = document.getElementById('cabecalho-escola')?.value || '';
            const turma = document.getElementById('cabecalho-turma')?.value || '';
            const turno = document.getElementById('cabecalho-turno')?.value || '';
            const professor = document.getElementById('cabecalho-professor')?.value || '';
            
            // 3. Recupera os detalhes das quest√µes
            const questoesDetalhes = finalSelectedIds.map(id => allQuestions[id]).filter(q => q);
            
            const dadosProva = {
                cabecalho: {
                    escola: escola,
                    logo: logoUrl,
                    turma: turma,
                    turno: turno,
                    disciplina: disciplina,
                    professor: professor,
                    periodo: periodo,  
                    duracao: duracao,  
                    data_prova: dataProva,
                },
                instrucoes_gerais: document.getElementById('instrucoes').value,
                layout_colunas: document.getElementById('layout').value,
                questoes_detalhes: questoesDetalhes,    
                data_geracao: new Date().toISOString(),
                criado_por_uid: CURRENT_USER_ID
            };
            
            try {
                localStorage.setItem('header_config', JSON.stringify({ escola, turma, professor, periodo, turno, duracao }));
            } catch(e) {
                console.warn("Falha ao salvar configura√ß√£o do cabe√ßalho no localStorage:", e);
            }


            const gabarito = gerarGabaritoInstantaneo(questoesDetalhes);
            dadosProva.gabarito = gabarito;

            const novaProvaRef = database.ref('provas').push();
            await novaProvaRef.set(dadosProva);

            messageEl.innerHTML = `<div class="alert-success"><i class="fas fa-trophy"></i> Prova criada e Gabarito gerado com sucesso!</div>`;
            document.getElementById('form-create-exam').reset();
            document.getElementById('cabecalho-data-prova').value = new Date().toISOString().substring(0, 10);
            
            selectedQuestionIdsForExam = [];    
            document.getElementById('selected-questions-from-bank').style.display = 'none';

            await updateExamListView();
            showPage('my-exams');    
            selectExam(novaProvaRef.key);

        } catch (error) {
            console.error("Erro ao criar prova:", error);
            messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-exclamation-circle"></i> Erro ao gerar prova: ${error.message}.</div>`;
        }
    }
    
    async function updateExamListView() {
        const snapshot = await database.ref('provas').once('value');
        allExams = snapshot.val() || {};
        filterExams();  
    }
/**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
    function filterExams() {
        const listEl = document.getElementById('my-exams-list');
        listEl.innerHTML = '';
        
        const filterText = document.getElementById('filter-exams-text').value.toLowerCase();
        document.getElementById('exam-details-view').style.display = 'none';

        if (Object.keys(allExams).length > 0) {
            const examsArray = Object.entries(allExams)
                .map(([id, prova]) => ({ id, ...prova }))
                .sort((a, b) => new Date(b.data_geracao) - new Date(a.data_geracao));    

            const examsFiltrados = examsArray.filter(e => {
                return e.cabecalho.disciplina.toLowerCase().includes(filterText) ||
                               e.cabecalho.turma.toLowerCase().includes(filterText) ||
                               formatDateTimeBR(e.data_geracao).includes(filterText);
            });

            if (examsFiltrados.length === 0) {
                listEl.innerHTML = '<li>Nenhuma prova encontrada com os filtros aplicados.</li>';
                return;
            }

            examsFiltrados.forEach(e => {
                const dataGeracaoBR = formatDateTimeBR(e.data_geracao);
                const dataProvaBR = e.cabecalho.data_prova ? new Date(e.cabecalho.data_prova).toLocaleDateString('pt-BR') : 'N/A';
                
                listEl.innerHTML += `
                    <li class="exam-list-item" onclick="selectExam('${e.id}')">
                        <div class="exam-info">
                            <span><strong>${e.cabecalho.disciplina}</strong> - ${e.cabecalho.turma} | Data Prova: ${dataProvaBR}</span>
                            <small>Gerada em: ${dataGeracaoBR}</small>
                        </div>
                        <button class="action-button btn-primary" onclick="selectExam('${e.id}')"><i class="fas fa-cogs"></i> Gerenciar</button>
                    </li>
                `;
            });
        } else {
            listEl.innerHTML = '<li>Nenhuma prova gerada.</li>';
        }
    }
    
    function selectExam(examId) {
        selectedExamId = examId;
        const prova = allExams[examId];
        if (prova) {
            document.getElementById('selected-exam-name').textContent = `Prova de ${prova.cabecalho.disciplina} (${prova.cabecalho.turma})`;
            document.getElementById('exam-details-view').style.display = 'block';
            document.getElementById('exam-preview').style.display = 'none';    
        }
    }

    
    window.openQuestionViewModal = function(questionId) {
        const q = allQuestions[questionId];
        if (!q) return;

        openModal('modal-question-view');
        
        document.getElementById('modal-question-id').value = questionId;
        document.getElementById('modal-question-title').textContent = `Visualizar/Editar Gabarito Quest√£o Q${q.id_sequencial}`;
        document.getElementById('modal-enunciado-text').textContent = q.enunciado.texto;
        
        const imgEl = document.getElementById('modal-enunciado-image');
        if (q.enunciado.midia) {
            imgEl.src = q.enunciado.midia;
            imgEl.style.display = 'block';
        } else {
            imgEl.style.display = 'none';
        }
        
        const altList = document.getElementById('modal-alternatives-list');
        altList.innerHTML = '';
        
        if (q.tipo_questao === 'M√∫ltipla Escolha') {
            q.alternativas.forEach(alt => {
                const isCorrect = q.resposta_correta === alt.letra;
                let imgHtml = '';
                if (alt.midia) {
                    imgHtml = `<img src="${alt.midia}" class="question-image-preview" style="max-width: 150px;" alt="Imagem Alternativa ${alt.letra}">`;
                }
                
                altList.innerHTML += `
                    <li>
                        <label>
                            <input type="radio" name="new_correct_answer" value="${alt.letra}" ${isCorrect ? 'checked' : ''}>
                            <strong>(${alt.letra})</strong> ${alt.texto}    
                            ${imgHtml}
                        </label>
                    </li>
                `;
            });
            document.getElementById('modal-resposta-correta-atual').textContent = q.resposta_correta;
            document.getElementById('modal-gabarito-form').querySelector('button').style.display = 'block';
        } else {
            altList.innerHTML = `<p>Esta √© uma quest√£o <strong>Discursiva</strong>. N√£o h√° alternativa correta √∫nica para alterar.</p>`;
            document.getElementById('modal-gabarito-form').querySelector('button').style.display = 'none';
            document.getElementById('modal-resposta-correta-atual').textContent = 'Discursiva';
        }
    }

    async function saveNewAnswer() {
        const questionId = document.getElementById('modal-question-id').value;
        const newAnswer = document.querySelector('#modal-gabarito-form input[name="new_correct_answer"]:checked')?.value;
        
        if (!questionId || !newAnswer) {
            alert("Selecione uma nova resposta ou cancele.");
            return;
        }

        try {
            await database.ref(`banco_questoes/${questionId}`).update({ resposta_correta: newAnswer });
            allQuestions[questionId].resposta_correta = newAnswer;
            alert(`Gabarito da Quest√£o Q${allQuestions[questionId].id_sequencial} atualizado para: ${newAnswer}`);
            closeModal('modal-question-view');
            filterQuestions();  
        } catch (e) {
            alert("Erro ao salvar a nova resposta: " + e.message);
        }
    }

    window.openQuestionEditModal = function(questionId) {
        const q = allQuestions[questionId];
        if (!q) return;

        document.getElementById('edit-question-firebaseId').value = questionId;
        document.getElementById('edit-question-id-sequencial').value = q.id_sequencial;
        document.getElementById('modal-edit-question-title').textContent = `Editar Quest√£o Q${q.id_sequencial}`;

        document.getElementById('edit-modalidade').value = q.modalidade;
        document.getElementById('edit-componente').value = q.componente_curricular;
        document.getElementById('edit-habilidade').value = q.habilidade_bncc || '';
        document.getElementById('edit-tipo').value = q.tipo_questao;
        document.getElementById('edit-enunciado').value = q.enunciado.texto;
        document.getElementById('edit-resposta-correta').value = q.resposta_correta;
        
        document.getElementById('edit-linhas-discursiva').value = q.linhas_discursiva || 4;

        const imgEl = document.getElementById('edit-enunciado-image-preview');
        if (q.enunciado.midia) {
            imgEl.src = q.enunciado.midia;
            imgEl.style.display = 'block';
        } else {
            imgEl.src = '';
            imgEl.style.display = 'none';
        }

        setupEditAlternativeInputs(q);
        toggleEditAlternatives(q.tipo_questao);
        openModal('modal-question-edit');
    }

    function setupEditAlternativeInputs(question) {
        const container = document.getElementById('edit-alternatives-inputs');
        container.innerHTML = '';
        const isMultipleChoice = question.tipo_questao === 'M√∫ltipla Escolha';

        ALTERNATIVE_LETTERS.forEach((letra, index) => {
            const alt = question.alternativas ? question.alternativas.find(a => a.letra === letra) || { texto: '', midia: '' } : { texto: '', midia: '' };
            
            let imagePreviewHtml = '';
            if (alt.midia) {
                imagePreviewHtml = `<small>Imagem Atual:</small><img src="${alt.midia}" class="image-preview-edit" alt="Imagem Alt ${letra} Atual">`;
            }

            container.innerHTML += `
                <div>
                    <label for="edit-alt${letra}"><strong>${letra})</strong> Texto:</label>
                    <textarea id="edit-alt${letra}" rows="2" placeholder="Texto da alternativa ${letra}" ${isMultipleChoice ? 'required' : ''}>${alt.texto}</textarea>
                    
                    <label for="edit-img${letra}">M√≠dia ${letra} (Selecione um novo arquivo para substituir):</label>
                    <input type="file" id="edit-img${letra}" accept="image/*">
                    ${imagePreviewHtml}
                </div>
            `;
        });

        document.getElementById('edit-alternatives-section').style.display = isMultipleChoice ? 'block' : 'none';
    }

    function toggleAlternatives(tipo) {
        document.getElementById('alternatives-section').style.display =  
            tipo === 'M√∫ltipla Escolha' ? 'block' : 'none';
        document.getElementById('linhas-discursiva-group').style.display =
            tipo === 'Discursiva' ? 'block' : 'none';
    }
    
    function toggleEditAlternatives(tipo) {
        const isMultipleChoice = tipo === 'M√∫ltipla Escolha';
        document.getElementById('edit-alternatives-section').style.display = isMultipleChoice ? 'block' : 'none';
        document.getElementById('edit-linhas-discursiva-group').style.display =
            tipo === 'Discursiva' ? 'block' : 'none';

        ALTERNATIVE_LETTERS.forEach(letra => {
            const textarea = document.getElementById(`edit-alt${letra}`);
            if (textarea) textarea.required = isMultipleChoice;
        });
    }
    
    async function handleEditQuestionSave() {
        const messageEl = document.getElementById('question-edit-message');
        messageEl.innerHTML = `<div class="alert-info"><i class="fas fa-sync fa-spin"></i> Salvando e atualizando uploads...</div>`;
        
        const questionId = document.getElementById('edit-question-firebaseId').value;
        const originalQuestion = allQuestions[questionId];

        try {
            const newEnunciadoFile = document.getElementById('edit-enunciado-imagem').files[0];
            let enunciadoUrl = originalQuestion.enunciado.midia || "";
            if (newEnunciadoFile) {
                enunciadoUrl = await uploadFileToImgBB(newEnunciadoFile);
            }

            const tipo = document.getElementById('edit-tipo').value;
            const linhasDiscursiva = tipo === 'Discursiva' ? parseInt(document.getElementById('edit-linhas-discursiva').value) : 0;
            
            const novasAlternativas = [];
            
            if (tipo === 'M√∫ltipla Escolha') {
                for (const letra of ALTERNATIVE_LETTERS) {
                    const altText = document.getElementById(`edit-alt${letra}`).value;
                    const altFile = document.getElementById(`edit-img${letra}`).files[0];
                    
                    const originalAlt = originalQuestion.alternativas.find(a => a.letra === letra);
                    let midiaUrl = originalAlt ? originalAlt.midia : "";
                    
                    if (altFile) {
                        midiaUrl = await uploadFileToImgBB(altFile);
                    }
                    
                    novasAlternativas.push({
                        letra: letra,
                        texto: altText,
                        midia: midiaUrl
                    });
                }
            }

            const dadosAtualizados = {
                modalidade: document.getElementById('edit-modalidade').value,
                componente_curricular: document.getElementById('edit-componente').value,
                habilidade_bncc: document.getElementById('edit-habilidade').value,
                enunciado: { texto: document.getElementById('edit-enunciado').value, midia: enunciadoUrl },
                tipo_questao: tipo,
                alternativas: novasAlternativas,
                resposta_correta: tipo === 'M√∫ltipla Escolha' ? document.getElementById('edit-resposta-correta').value : "Discursiva",
                linhas_discursiva: linhasDiscursiva,
                data_edicao: new Date().toISOString()
            };

            await database.ref(`banco_questoes/${questionId}`).update(dadosAtualizados);
            
            Object.assign(allQuestions[questionId], dadosAtualizados);
            
            messageEl.innerHTML = `<div class="alert-success"><i class="fas fa-check-circle"></i> Quest√£o Q${originalQuestion.id_sequencial} salva com sucesso!</div>`;
            
            filterQuestions();
            setTimeout(() => closeModal('modal-question-edit'), 1500);

        } catch (error) {
            console.error("Erro ao editar quest√£o:", error);
            messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-exclamation-circle"></i> Erro ao salvar a edi√ß√£o: ${error.message}</div>`;
        }
    }
    
    function openEditExamModal() {
        if (!selectedExamId) return;
        const prova = allExams[selectedExamId];
        
        document.getElementById('modal-edit-exam-name').textContent = prova.cabecalho.disciplina;
        document.getElementById('edit-escola').value = prova.cabecalho.escola;
        document.getElementById('edit-turma').value = prova.cabecalho.turma;
        document.getElementById('edit-professor').value = prova.cabecalho.professor;
        document.getElementById('edit-duracao').value = prova.cabecalho.duracao;
        document.getElementById('edit-data-prova').value = prova.cabecalho.data_prova;  

        openModal('modal-edit-exam');
    }

    async function handleEditExamSave() {
        const messageEl = document.getElementById('edit-exam-message');
        const updates = {
            escola: document.getElementById('edit-escola').value,
            turma: document.getElementById('edit-turma').value,
            professor: document.getElementById('edit-professor').value,
            duracao: document.getElementById('edit-duracao').value,
            data_prova: document.getElementById('edit-data-prova').value,
        };
        
        try {
            await database.ref(`provas/${selectedExamId}/cabecalho`).update(updates);
            
            Object.assign(allExams[selectedExamId].cabecalho, updates);
            updateExamListView();
            
            messageEl.innerHTML = `<div class="alert-success"><i class="fas fa-check"></i> Prova atualizada com sucesso!</div>`;
            setTimeout(() => closeModal('modal-edit-exam'), 1500);
        } catch (e) {
            messageEl.innerHTML = `<div class="alert-error"><i class="fas fa-exclamation-circle"></i> Erro ao salvar edi√ß√£o: ${e.message}</div>`;
        }
    }
    
    async function deleteExam() {
        if (!selectedExamId || !confirm("Tem certeza que deseja EXCLUIR esta prova? Esta a√ß√£o √© irrevers√≠vel.")) return;
        try {
            await database.ref(`provas/${selectedExamId}`).remove();
            delete allExams[selectedExamId];
            selectedExamId = null;
            updateExamListView();
            alert("Prova exclu√≠da com sucesso.");
        } catch (e) {
            alert("Erro ao excluir prova: " + e.message);
        }
    }

    function getAntiFraudGarbage() {
        const randomString = Math.random().toString(36).substring(2, 8);
        return `<span class="af-garbage">${randomString}</span>`;
    }

    function obfuscateText(text) {
        if (!text) return "";
        let newText = "";
        let chars = text.split("");
        
        for (let i = 0; i < chars.length; i++) {
            newText += chars[i];
            if (Math.random() > 0.6) {
                newText += getAntiFraudGarbage();
            }
        }
        return newText;
    }

    function gerarHTMLProva(prova) {
    const cab = prova.cabecalho;
    const dataProvaBR = cab.data_prova ? new Date(cab.data_prova).toLocaleDateString('pt-BR') : '__/__/____';
    const logoSrc = cab.logo && cab.logo.trim() !== '' ? cab.logo : 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="#fff" stroke="#ccc" stroke-width="1"/><text x="50" y="55" font-family="Arial, sans-serif" font-size="18" fill="#aaa" text-anchor="middle">LOGO</text></svg>';

    let htmlContent = '';

    // Estilos Inline Cr√≠ticos para o Layout de Colunas
    htmlContent += `
        <style>
            .questions-wrapper {
                column-count: var(--print-col-count);
                column-gap: 30px;
                column-fill: auto;
                width: 100%;
            }
            .question-item-print {
                break-inside: avoid; /* Impede que a quest√£o quebre entre colunas */
                page-break-inside: avoid;
                margin-bottom: 20px;
                word-wrap: break-word;
                overflow-wrap: break-word; /* For√ßa a quebra de texto longo */
                word-break: break-word;
                box-sizing: border-box;
                width: 100%;
            }
            .q-enunciado {
                max-width: 100%;
                overflow: hidden;
            }
            .image-preview, .image-preview-small {
                max-width: 100% !important; /* Garante que a imagem nunca saia da coluna */
                height: auto;
                object-fit: contain;
            }
            .alternative-list-print li {
                margin-bottom: 5px;
                break-inside: avoid;
            }
        </style>
    `;

    htmlContent += `
        <div class="exam-header-print">
            <div class="logo-area">
                <img src="${logoSrc}" alt="Logo da Escola">
            </div>
            <div style="border-left: 1px solid #000;">
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <td colspan="4" style="text-align: center; font-weight: bold; border-top: none;">
                            ${cab.escola.toUpperCase()}
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4" style="text-align: right; border-top: none;">
                            <span style="font-weight: bold; margin-right: 15px;">TURMA: ${cab.turma.toUpperCase()}</span> |
                            <span style="font-weight: bold; margin-right: 15px;">TURNO: ${cab.turno.toUpperCase()}</span> |
                            <span style="font-weight: bold;">DATA:</span> ${dataProvaBR}
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4" style="border-top: 1px solid #000;">
                            <span style="font-weight: bold;">ALUNO(A)</span>
                            <span style="display: inline-block; border-bottom: 1px dashed #000; width: 55%; margin-right: 5px;"></span>
                            <span style="font-weight: bold;">N¬∫</span>
                            <span style="display: inline-block; border-bottom: 1px dashed #000; width: 8%; margin-right: 5px;"></span>
                            <span style="font-weight: bold;">SALA:</span>
                            <span style="display: inline-block; border-bottom: 1px dashed #000; width: 8%;"></span>
                        </td>
                    </tr>
                    <tr>
                        <td rowspan="2" style="font-weight: bold; text-align: center; width: 15%; border-left: none; border-top: 1px solid #000;">
                            ${cab.periodo ? cab.periodo.toUpperCase() : 'PER√çODO'}
                        </td>
                        <td style="width: 50%; border-top: 1px solid #000;">
                            <span style="font-weight: bold;">PROFESSOR(A):</span> ${cab.professor}
                        </td>
                        <td rowspan="2" style="font-weight: bold; width: 20%; text-align: center; border-top: 1px solid #000;">
                            NOTA:
                        </td>
                    </tr>
                    <tr>
                        <td style="border-top: 1px solid #000;">
                            <span style="font-weight: bold;">COMPONENTE CURRICULAR:</span> ${cab.disciplina}
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <p class="instructions-text" style="margin-top: 15px;">
            <strong>Instru√ß√µes Gerais:</strong> ${prova.instrucoes_gerais}
        </p>
    `;

    htmlContent += `<div class="questions-wrapper" style="--print-col-count: ${prova.layout_colunas || 1};">`;
    
    prova.questoes_detalhes.forEach((q, index) => {
        const numero = index + 1;
        const enunciadoSeguro = obfuscateText(q.enunciado.texto);
        
        htmlContent += `
            <div class="question-item-print">
                <div class="q-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <strong style="display: flex; align-items: center; gap: 5px; color: #3f51b5;">
                        <i class="fas fa-book-open" style="color: #ff9800;"></i> QUEST√ÉO ${numero}
                    </strong>  
                    <span class="q-number-box" style="border: 1px solid #000; padding: 2px 4px; font-size: 9pt; font-weight: bold; color: #f44336;">
                        ${q.habilidade_bncc || 'N/A'}
                    </span>
                </div>
                
                <div class="q-enunciado" style="font-size: 11pt; margin-bottom: 10px; line-height: 1.4;">${enunciadoSeguro}</div>
        `;
        
        if (q.enunciado.midia) {
             htmlContent += `<img src="${q.enunciado.midia}" class="image-preview" alt="Imagem da Quest√£o ${numero}" style="margin: 8px auto;">`;
        }

        if (q.tipo_questao === 'M√∫ltipla Escolha') {
            htmlContent += '<ul class="alternative-list-print" style="list-style: none; padding: 0;">';
            q.alternativas.forEach(alt => {
                const textoAltSeguro = obfuscateText(alt.texto);
                htmlContent += `
                    <li style="margin-bottom: 8px;">
                        <label style="display: flex; align-items: flex-start; font-size: 10.5pt;">
                            <span style="min-width: 25px; font-weight: bold;">${alt.letra})</span> 
                            <span style="flex: 1;">${textoAltSeguro}</span>
                        </label>`;  
                if (alt.midia) {
                    htmlContent += `<img src="${alt.midia}" class="image-preview-small" style="margin: 5px 0 5px 25px;">`;
                }
                htmlContent += '</li>';
            });
            htmlContent += '</ul>';
        } else {
            const linhas = q.linhas_discursiva || 4;
            const minHeight = linhas * 20; // Aproximadamente 20px por linha
            
             htmlContent += `<div class="discursiva-answer-space" style="border: 1px solid #eee; min-height: ${minHeight}px; font-size: 9pt; color: #ccc; padding: 5px;">Espa√ßo para resposta</div>`;
        }
        
        htmlContent += `</div>`;
    });

    htmlContent += `</div>`;
    return htmlContent;
}

    function visualizarProvaDetalhe() {
        if (!selectedExamId) return;
        const prova = allExams[selectedExamId];

        const printContentEl = document.getElementById('exam-content-print');
        
        printContentEl.style.setProperty('--print-col-count', 1);

        printContentEl.innerHTML = gerarHTMLProva(prova);

        document.getElementById('exam-preview').style.display = 'block';
    }

    function exportarProva(tipo) {
        if (!selectedExamId) return;
        const prova = allExams[selectedExamId];
        
        const html = gerarHTMLProva(prova);
        
        const printArea = document.getElementById('print-area-container');
        
        printArea.innerHTML = html;
        
        printArea.style.setProperty('--print-col-count', prova.layout_colunas || 1);

        window.print();
        
        setTimeout(() => {
            printArea.innerHTML = '';
        }, 500);
        
        alert(`‚úÖ Prova Gerada com Prote√ß√£o Anti-Fraude!\n\nSe tentarem converter este PDF para Word, o texto ficar√° ileg√≠vel devido √† criptografia visual implementada.`);
    }
    
    function baixarGabarito() {
        if (!selectedExamId) return;
        const prova = allExams[selectedExamId];
        const content = prova.gabarito;
        
        const filename = `Gabarito_${prova.cabecalho.disciplina}_${new Date().toISOString().substring(0, 10)}.txt`;
        const element = document.createElement('a');
        element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
        element.setAttribute('download', filename);
        element.style.display = 'none';
        document.body.appendChild(element);
        element.click();
        document.body.removeChild(element);
        alert("Gabarito baixado em TXT.");
    }

    async function updateDashboardIndicators() {
        try {
            const questaoSnapshot = await database.ref('banco_questoes').once('value');
            const provaSnapshot = await database.ref('provas').once('value');
            const userSnapshot = await database.ref('usuarios').once('value');

            const totalQuestoes = questaoSnapshot.exists() ? Object.keys(questaoSnapshot.val()).length : 0;
            const totalProvas = provaSnapshot.exists() ? Object.keys(provaSnapshot.val()).length : 0;
            
            const users = userSnapshot.val();
            const usersArray = users ? Object.values(users) : [];
            const active = usersArray.filter(u => u.status === 'Aprovado');
            const totalPendentes = usersArray.filter(u => u.status === 'Pendente').length;
            const totalPadrao = active.filter(u => u.role === 'Padr√£o').length;
            const totalAdm = active.filter(u => u.role === 'ADM').length;
            
            document.getElementById('dash-total-questoes').textContent = totalQuestoes;
            document.getElementById('dash-total-provas').textContent = totalProvas;
            document.getElementById('dash-total-padrao').textContent = totalPadrao;
            document.getElementById('dash-total-adm').textContent = totalAdm;
            document.getElementById('dash-total-pendentes').textContent = totalPendentes;
        } catch (e) {
            console.error("Erro ao carregar indicadores:", e);
        }
    }

    function loadHeaderConfig() {
        try {
            const config = JSON.parse(localStorage.getItem('header_config'));
            if (config) {
                document.getElementById('cabecalho-escola').value = config.escola || '';
                document.getElementById('cabecalho-professor').value = CURRENT_USER?.nome || '';  
                document.getElementById('cabecalho-turma').value = config.turma || '';
                document.getElementById('cabecalho-periodo').value = config.periodo || '1¬∫ PER√çODO';
                document.getElementById('cabecalho-turno').value = config.turno || 'Matutino';
            }
        } catch (e) {
            console.warn("Nenhuma configura√ß√£o de cabe√ßalho encontrada ou inv√°lida.");
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        setupAlternativeInputs();
        document.getElementById('cabecalho-data-prova').value = new Date().toISOString().substring(0, 10);
        
        toggleAlternatives('M√∫ltipla Escolha');
    });
//
      /**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 *//**
 * ============================================================================
 * üõ°Ô∏è AVISO DE PROPRIEDADE INTELECTUAL E DIREITOS AUTORAIS
 * ============================================================================
 * * @owner        ATECSEVEN TECNOLOGIA
 * @cnpj         63.363.373/0001-72
 * * ESTE C√ìDIGO FONTE √â PROPRIEDADE EXCLUSIVA DA ATECSEVEN TECNOLOGIA.
 * * √â ESTRITAMENTE PROIBIDA a c√≥pia, reprodu√ß√£o, distribui√ß√£o, modifica√ß√£o
 * ou comercializa√ß√£o deste c√≥digo, total ou parcialmente, sem a expressa
 * autoriza√ß√£o por escrito da detentora dos direitos.
 * * A viola√ß√£o destes termos est√° sujeita √†s penalidades previstas na legisla√ß√£o
 * brasileira vigente:
 * - Lei n¬∫ 9.609/98 (Prote√ß√£o da Propriedade Intelectual de Software).
 * - Lei n¬∫ 9.610/98 (Lei de Direitos Autorais).
 * - C√≥digo Penal Brasileiro (Art. 184 - Viola√ß√£o de direito autoral).
 * * O infrator estar√° sujeito a PROCESSO JUDICIAL nas esferas C√≠vel e Criminal,
 * respondendo por perdas e danos e lucros cessantes.
 * * ¬© ATECSEVEN TECNOLOGIA - Todos os direitos reservados.
 * ============================================================================
 */
</script>
</body>
</html>
